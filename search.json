[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Perspectives of Fiji from open data sets",
    "section": "",
    "text": "Introduction\nAs part of preparing for a recent trip to Fiji, I looked to see what open data is available and what I could learn from it. I’m happy to report that there seems to be a lot more data available now compared to the last time I looked some years ago.\nIn the following pages I sketch from open data a small number of the characteristics of Fiji, natural and human-centered, and put them in context with other countries, including Pacific Island countries and territories (PICTs). This sketch will not capture the fullness of life in Fiji in the people, the land, or the sea. You have to go yourself to experience it.\nThe Fiji Islands is an independent country straddling the international date line and located mostly between 16° and 18° South. It’s a 3-to-3.5 hour flight from Nadi, the primary international airport, to Auckland, New Zealand. Fiji is among the largest and most economically developed PICTs. Most of the non-governmental organizations serving the South Pacific seem to have their primary local headquarters in Fiji (they were my customers when I was general manager of South Seas Computing (Fiji) Ltd. in the nineties).\nThe articles about Fiji at Britannica.com, CIA Factbook 2023 and Wikipedia offer useful summaries that I won’t repeat here. Similarly, another source of interest (not used here) is this Fiji-specific fact sheet published by the Fiji Bureau of Statistics: Fact Sheet - preliminary findings of the Fiji Multiple Indicator Cluster Survey 2021 (MICS).",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "index.html#acknowledgements",
    "href": "index.html#acknowledgements",
    "title": "Perspectives of Fiji from open data sets",
    "section": "Acknowledgements",
    "text": "Acknowledgements\nI’m grateful to the organizations and individuals who made data available:\n\nPacific Community (SPC) and the Pacific Data Hub, where the data was prepared in each country’s Bureau of Statistics, the UN, or international NGO.\nFiji Bureau of Statistics\nU.S. National Oceanic and Atmospheric Administration (NOAA) Coral Reef Watch and NowCOAST\nGEBCO Grid2023 bathymetry\nOpen Street Map and Open Sea Map\nNew Zealand Land Information portal\nUN Global Reef Distribution project\nReserve Bank of Fiji\nWorld Bank\nEuropean Central Bank\n\nI’m also grateful to those in the R ecosystem who produce and maintain high-quality open source tools for data analysis and visualization, write tutorials, publish examples, and answer questions in forums that help countless people (like me!) who come along later. I used RStudio with the following packages published on CRAN.\n\nTidyverse plus tidyverse-adjacent: patchwork, ggrepel, ggridges, scales, units, janitor, glue, here, gt\nGIS: sf, terra, tidyterra, rnaturalearth, osmdata\n\n– Daniel Moul\n\n\nCover image: The children of Nasauvakarua village located in the Western Division near the center of Viti Levu and the headwaters of the Sigatoka River. Source: https://fijiclimatechangeportal.gov.fj/gallery/climate-change/ specifically: https://fijiclimatechangeportal.gov.fj/wp-content/uploads/photo-gallery/Climate_Change/Children-of-Nasauvakarua-village.jpg?bwg=1644208434",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "fiji-geo-context.html",
    "href": "fiji-geo-context.html",
    "title": "1  Fiji in geographical context",
    "section": "",
    "text": "1.1 PICT land and water area\nLike many other Pacific island countries and territories, there is an extensive exclusive economic zone (EEZ) surrounding the Fiji Islands:\nShow the code\nknitr::include_graphics(here(\"images/status-pacific-maritime-boundaries-spc-2020.png\"))\n\n\n\n\n\n\n\n\nFigure 1.2: Status of maritime boundaries July 20201\nShow the code\nd_pocket &lt;- read_csv(here(\"./data/raw/pocket-summary/SPC_DF_POCKET_3.0_all.csv\"),\n               show_col_types = FALSE) |&gt;\n  clean_names() |&gt;\n  remove_empty(which = \"cols\") |&gt;\n  remove_constant() |&gt;\n  # rename(place = pacific_island_countries_and_territories) |&gt;\n  mutate(place = case_match(\n    pacific_island_countries_and_territories,\n    \"Micronesia (Federated States of)\"  ~ \"Micronesia (FSM)\",\n    \"Northern Mariana Islands\"          ~ \"N Mariana Is\",\n    .default = pacific_island_countries_and_territories\n  ))\nThe the land area and Exclusive Economic Zone (EEZ) in the surrounding ocean varies widely among the PICTs.\nShow the code\nd_area_eez &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Land area\", \"EEZ area\")) |&gt;\n  arrange(desc(time_period)) |&gt;\n  distinct(geo_pict, indicator_2, .keep_all = TRUE) |&gt;\n  select(-c(time_period, unit_mult, unit_multiplier, data_year)) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names() |&gt;\n  mutate(land_pct_of_eez = land_area / eez_area)\n\nd_area_eez |&gt;\n  ggplot(aes(eez_area, land_area)) +\n  geom_vline(xintercept = c(3e5, 1e6, 3e6),\n             lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_hline(yintercept = 10^c(1:5),\n             lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_point(aes(size = land_pct_of_eez), \n             color = \"firebrick\", alpha = 0.3) +\n  geom_text_repel(aes(label = place),\n            hjust = 0, vjust = 1) +\n  scale_x_log10(labels = label_number(scale_cut = cut_short_scale()),\n                ) +\n  scale_y_log10(labels = label_number(scale_cut = cut_short_scale())) +\n  scale_size_continuous(range = c(1, 10),\n                        labels = percent,\n                        breaks = c(0.001, 0.01, 0.05, 0.1, 0.15)) +\n  expand_limits(x = 1e7) +\n  labs(\n    title = \"Fiji is among the fortunate PICTs with an EEZ\\nof more than 1M km2\",\n    subtitle = \"Pacific island land area by exclusive economic area (EEZ) water area\",\n    x = \"EEZ area km2 (log10 scale)\",\n    y = \"Land area km2 (log10 scale)\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 1.3: Fiji is among the fortunate PICTs with an EEZ of more than 1M km2\nSome PICTs don’t rise much above sea level, others are mountainous.\nShow the code\nd_area_height &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Land area\", \"Max height above sea level\")) |&gt;\n  arrange(desc(time_period)) |&gt;\n  distinct(geo_pict, indicator_2, .keep_all = TRUE) |&gt;\n  select(-c(time_period, unit_mult, unit_multiplier, data_year)) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names()\n\nd_area_height |&gt;\n  ggplot(aes(land_area, max_height_above_sea_level)) +\n  annotate(\"rect\", ymin = 1, ymax = 1000, xmin = 1, xmax = 1000,\n           fill = \"gold\", alpha = 0.1) +\n  # geom_vline(xintercept = 10^c(1:5),\n  #            lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_point(size = 3,\n             color = \"firebrick\", alpha = 0.3) +\n  geom_text_repel(aes(label = place),\n                  force = 2,\n                  hjust = 0, vjust = 1) +\n  scale_x_log10(labels = label_number(scale_cut = cut_short_scale()),\n                expand = expansion(mult = c(0, 0.05)),\n                breaks = 10^c(1:5)\n  ) +\n  scale_y_log10(labels = label_number(scale_cut = cut_short_scale()),\n                expand = expansion(mult = c(0, 0.05))) +\n  labs(\n    title = \"Fiji is among the most mountainous PICTs\", \n    subtitle = glue(\"Max height above sea level\",\n                    \"\\nEspecially vulnerable PICTs are smaller and have lower elevations (in yellow area)\",\n                    \"\\nPICTs with higher elevations are still vulnerable, since many people live near the sea\"),\n    y = \"Max height m \",\n    x = \"Land area km2 (log10 scale)\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 1.4: Fiji is among the most mountainous PICTs",
    "crumbs": [
      "Natural world",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Fiji in geographical context</span>"
    ]
  },
  {
    "objectID": "fiji-geo-context.html#focus-on-fiji",
    "href": "fiji-geo-context.html#focus-on-fiji",
    "title": "1  Fiji in geographical context",
    "section": "1.2 Focus on Fiji",
    "text": "1.2 Focus on Fiji\nFiji consists of more than 300 islands (more at low tide!). More than 80% of the people live on the main island of Vitu Levu. The capital Suva is in the southeast, and the international airport Nadi (“nandi”) is in the west.\n\n\nShow the code\nknitr::include_graphics(here(\"images/fiji-zoomed-out-nowcoast-satellite-2024-06-22-lightened.png\"))\n\n\n\n\n\n\n\n\nFigure 1.5: Satellite image and bathymetry of most of the Fiji islands2\n\n\n\n\n\n\nMost visitors coming for a holiday to Fiji arrive at Nadi airport on the western side of Viti Levu and stay nearby, since this area generally has the best weather, picturesque South Seas islands, and is easily accessible. The Mamanucas are the island group closest to Nadi, further north are the Yasawas.\nSince my travels include the Yasawas, I will focus on the area between Nadi and the Yasawas.\n\n\nShow the code\nknitr::include_graphics(here(\"images/fiji-yasawas-mamanuthas-nowcoast-satellite-2024-06-22-lightened.png\"))\n\n\n\n\n\n\n\n\nFigure 1.6: Visual satellite image of western Viti Levu, the Mamanucas, and the Yawawas3\n\n\n\n\n\n\nThe water in this area is relatively shallow and interspersed with reefs. To the northwest of the Yasawas the shelf drops off quickly.\n\n\nShow the code\n###### GEBCO bathymetry grid2023\n\nfj_file1 &lt;- here(\"data/raw/GEBCO_22_Jun_2024_4b31746b7734/gebco_2023_n-16.6484_s-17.8168_w177.0208_e178.1079.tif\")\n\nfj_bath &lt;- terra::rast(here(fj_file1)) |&gt;\n  rename(elev = `gebco_2023_n-16.6484_s-17.8168_w177.0208_e178.1079`)\n\nmy_bbox &lt;- st_bbox(fj_bath)\n# my_bbox_ext &lt;- ext(fj_bath)\n\nfj_bath_spatraster &lt;- as_spatraster(fj_bath) |&gt;\n  mutate(elev = if_else(elev &gt;= 0,\n                        NA,\n                        elev)) |&gt;\n  mutate(depth = -1 * elev) |&gt;\n  crop(coastline$osm_points)\n\nbbox_spat &lt;- ext(fj_bath_spatraster)\n# SpatExtent : 177.029166666667, 178.108333333333, -17.8166666666667, -16.65 (xmin, xmax, ymin, ymax)\n\n\n\n\nShow the code\nplot_alpha &lt;- 0.8\n\nggplot() +\n  geom_spatraster_contour_filled(data = fj_bath_spatraster |&gt;\n                                   select(-1),\n                          breaks = c(1, 5, 25, 50, 75, 150, 300, 1000, 2000, 3000, 4000),\n                          , alpha = plot_alpha,\n                          na.rm = TRUE) +\n  geom_sf(data = coastline$osm_points,\n          color = \"brown\", fill = \"brown\", size = 0.001, alpha = plot_alpha) +\n  # geom_sf(data = islands$osm_polygons,\n  #         color = \"brown\", fill = \"brown\", linewidth = 0.001, alpha = plot_alpha) +\n  geom_sf(data = islands$osm_multipolygons,\n          color = \"brown\", fill = \"brown\", linewidth = 0.001, alpha = plot_alpha) +\n  geom_sf(data = coastline$osm_polygons,\n          color = \"brown\", fill = \"brown\", linewidth = 0.001, alpha = plot_alpha) +\n  # geom_sf(data = coastline$osm_polygons,\n  #         color = \"brown\", fill = \"brown\", size = 0.001, alpha = plot_alpha) +\n  coord_sf(xlim = bbox_spat[c(1, 2)], # min & max of x values\n           ylim = bbox_spat[c(3, 4)]) +\n  scale_x_continuous(expand = expansion(mult = c(0,0))) +\n  scale_y_continuous(expand = expansion(mult = c(0,0))) +\n  # scale_fill_viridis_d(direction = -1,\n  #                      na.value = \"transparent\") +\n  tidyterra::scale_fill_hypso_tint_d(palette = \"etopo1_bathy\",\n                                     direction = -1) +\n  guides(fill = guide_legend(reverse = FALSE,\n                             position = \"inside\",\n                             ncol = 2)) +\n  theme(panel.background = element_rect(fill = \"#F5DEB3\"), \n        # \"#FFFACD99\"), # Doesn't seem panel.background honors alpha suffix \"99\"\n        legend.position.inside = c(0.8, 0.15),\n        axis.text = element_blank(),\n        axis.ticks = element_blank()) +\n  labs(\n    title = \"Bathymetry of the Yasawas, Mamanucas,\\nand northwestern Viti Levu\",\n    subtitle = \"Brown areas are land; cream-colored areas are shallows and reefs\\nthat in some cases reach to sea level\",\n    caption = \"Plot: Daniel Moul. Data: land masses from OSM, bathymetry from GEBCO Grid2023\",\n    fill = \"Depth (m)\"\n  )\n\n\n\n\n\nBathymetry of the Yasawas, Mamanucas, and northwestern Viti Levu\n\n\n\n\n\nThe drop-of is more visible in the color scheme used by the Open Sea Map:\n\n\nShow the code\nknitr::include_graphics(here(\"images/western-fiji-yasawas-openseamap-2024-06-22.png\"))\n\n\n\n\n\n\n\n\nFigure 1.7: Western Viti Levu and the Yasawa islands: Open Sea Map with depths in meters4 based on data from Open Street Map.\n\n\n\n\n\n\nZooming in on the Yasawas:\n\n\nShow the code\nknitr::include_graphics(here(\"images/fiji-yasawas-closeup-openseamap-2024-06-07.png\"))\n\n\n\n\n\n\n\n\nFigure 1.8: Yasawa islands: Open Sea Map with depths in meters5 based on data from Open Street Map.\n\n\n\n\n\n\nMarine charts represent this information differently:\n\n\nShow the code\nknitr::include_graphics(here(\"images/western-fiji-yasawas-land-info-nz-2020.png\"))\n\n\n\n\n\n\n\n\nFigure 1.9: Western Fiji including the Yasawa islands6",
    "crumbs": [
      "Natural world",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Fiji in geographical context</span>"
    ]
  },
  {
    "objectID": "fiji-geo-context.html#footnotes",
    "href": "fiji-geo-context.html#footnotes",
    "title": "1  Fiji in geographical context",
    "section": "",
    "text": "GEM, Pacific Community https://gem.spc.int/news/2020/09/the-status-of-pacific-regional-maritime-boundaries-as-of-july-2020 ↩︎\nNOAA nowCOAST 2024-06-22 https://nowcoast.noaa.gov ↩︎\nNOAA nowCOAST 2024-06-22 https://nowcoast.noaa.gov ↩︎\nOpenseamap.org https://map.openseamap.org/?zoom=9.9&lon=177.40986&lat=-17.15530&layers=TFFFFTFFFFFFFFFFTFFFFF ↩︎\nOpenseamap.org https://map.openseamap.org/?zoom=10.9&lon=177.38484&lat=-16.95830&layers=TFFFFTFFFFFFFFFFTFFFFF ↩︎\nWestern Fiji including the Yasawa islands Land Information NZ July 2020 NZ 14638 Fiji to Kermadec Islands including Tongatapu INT number 638 Scale 1 to 1500000 TODO: add link here ↩︎",
    "crumbs": [
      "Natural world",
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Fiji in geographical context</span>"
    ]
  },
  {
    "objectID": "reefs.html#footnotes",
    "href": "reefs.html#footnotes",
    "title": "2  Reefs",
    "section": "",
    "text": "https://www.taylorfrancis.com/chapters/mono/10.1201/9781003287339-15/atolls-fiji-walter-goldberg-eugene-rankey ↩︎\nUNEP-WCMC, WorldFish Centre, WRI, TNC (2021). Global distribution of warm-water coral reefs, compiled from multiple sources including the Millennium Coral Reef Mapping Project. Version 4.1. Includes contributions from IMaRS-USF and IRD (2005), IMaRS-USF (2005) and Spalding et al. (2001). Cambridge (UK): UN Environment World Conservation Monitoring Centre. Data DOI: https://doi.org/10.34892/t2wk-5t34 and https://data.unep-wcmc.org/datasets/1 ↩︎\nI was not able to find Exposed Reefs online.↩︎",
    "crumbs": [
      "Natural world",
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Reefs</span>"
    ]
  },
  {
    "objectID": "coral-bleaching-watch.html#footnotes",
    "href": "coral-bleaching-watch.html#footnotes",
    "title": "3  Coral bleaching watch",
    "section": "",
    "text": "The world’s corals are bleaching. Here’s why and what it means for the ocean’s future. UN Environment Programme. 06 JUN 2024. https://www.unep.org/news-and-stories/story/worlds-corals-are-bleaching-heres-why-and-what-it-means-oceans-future↩︎\nMethodology, Product Description, and Data Availability of NOAA Coral Reef Watch’s Version 3.1 Daily Global 5km Satellite Coral Bleaching Heat Stress Monitoring Products https://coralreefwatch.noaa.gov/product/5km/methodology.php↩︎\nNOAA Coral Reef Watch home page https://coralreefwatch.noaa.gov/main/↩︎\nSee NOAA Coral Reef Watch map and introduction at https://coralreefwatch.noaa.gov/product/vs/map.php↩︎\nThe Daily Global 5km Satellite Coral Bleaching Heat Stress Monitoring regional alerts are available at https://coralreefwatch.noaa.gov/product/5km/index.php ↩︎\nThe current Pacific regional image is at https://coralreefwatch.noaa.gov/data_current/5km/v3.1_op/daily/png/ct5km_baa5-max-7d_v3.1_pacific_current.png ↩︎\nPacific Climate Science Program (2011). Current and future climate of the Fiji Islands (PDF) (Report). Australian Government. https://www.pacificclimatechangescience.org/wp-content/uploads/2013/06/1_PCCSP_Fiji_8pp.pdf↩︎\nMethodology, Product Description, and Data Availability of NOAA Coral Reef Watch’s Version 3.1 Daily Global 5km Satellite Coral Bleaching Heat Stress Monitoring Products https://coralreefwatch.noaa.gov/product/5km/methodology.php↩︎",
    "crumbs": [
      "Natural world",
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Coral bleaching watch</span>"
    ]
  },
  {
    "objectID": "pocket-summary.html",
    "href": "pocket-summary.html",
    "title": "4  Pocket summary comparisons among PICTs",
    "section": "",
    "text": "4.1 Population\nThe population and land area of the PICTs vary over four orders of magnitude. Population density is highest on some of the smallest PICTs.\nShow the code\nd_pop_and_density &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Land area\", \"Mid-year population estimate\")) |&gt;\n  arrange(desc(time_period)) |&gt;\n  distinct(geo_pict, indicator_2, .keep_all = TRUE) |&gt;\n  select(-c(time_period, unit_mult, unit_multiplier, data_year)) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names() |&gt;\n  rename(pop = mid_year_population_estimate) |&gt;\n  mutate(pop_density = pop / land_area)\n\nd_pop_and_density |&gt;\n  ggplot(aes(land_area, pop)) +\n  geom_hline(yintercept = 10^c(3:6),\n             lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_point(aes(size = pop_density), \n             color = \"firebrick\", alpha = 0.3) +\n  geom_smooth(se = FALSE, method = \"lm\", formula = 'y ~ x',\n              alpha = 0.05) +\n  geom_text_repel(aes(label = place),\n                  force = 2,\n                  hjust = 0, vjust = 1) +\n  scale_x_log10(labels = label_number(scale_cut = cut_short_scale()),\n                ) +\n  scale_y_log10(labels = label_number(scale_cut = cut_short_scale()),\n                breaks = 10^c(3:7)) +\n  scale_size_continuous(range = c(1, 10),\n                        breaks = c(10, 100, 300, 600)\n                        ) +\n  expand_limits(x = 1e7) +\n  guides(size = guide_legend(position = \"inside\"),\n         color = \"none\") +\n  theme(legend.position.inside = c(0.8, 0.3)) +\n  labs(\n    title = glue(\"Fiji is among the largest PICTs in population and land area\",\n                 \"\\nand is typical in population density for its land area\"),\n    subtitle = \"Pacific island population 2023, land area, and population density\",\n    x = \"Land area km2 (log10 scale)\",\n    y = \"Population estimate (log10 scale)\",\n    size = \"Density\\n(people/km2)\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 4.1: Population, land area, and population density\nFigure 4.1 above visualizes the data in this table:\nShow the code\nd_pop_and_density |&gt;\n  arrange(desc(pop_density)) |&gt;\n  mutate(rank = row_number()) |&gt;\n  gt() |&gt;\n  tab_header(md(glue(\"**Pacific Island land area, population, and population density**\",\n                     \"&lt;br&gt;Ranked by population density (people per km2)\"))) |&gt;\n  tab_options(table.font.size = 10) |&gt;\n  fmt_number(columns = c(land_area, pop, pop_density),\n             decimals = 0)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPacific Island land area, population, and population densityRanked by population density (people per km2)\n\n\ngeo_pict\nplace\nland_area\npop\npop_density\nrank\n\n\n\n\nNR\nNauru\n20\n12,017\n601\n1\n\n\nTV\nTuvalu\n30\n10,876\n363\n2\n\n\nGU\nGuam\n540\n181,468\n336\n3\n\n\nMH\nMarshall Islands\n180\n54,366\n302\n4\n\n\nAS\nAmerican Samoa\n200\n57,225\n286\n5\n\n\nKI\nKiribati\n810\n124,742\n154\n6\n\n\nFM\nMicronesia (FSM)\n700\n106,194\n152\n7\n\n\nTK\nTokelau\n10\n1,500\n150\n8\n\n\nTO\nTonga\n720\n99,026\n138\n9\n\n\nMP\nN Mariana Is\n460\n57,154\n124\n10\n\n\nPF\nFrench Polynesia\n3,471\n281,811\n81\n11\n\n\nWF\nWallis and Futuna\n140\n11,231\n80\n12\n\n\nWS\nSamoa\n2,780\n202,100\n73\n13\n\n\nCK\nCook Islands\n240\n15,470\n64\n14\n\n\nFJ\nFiji\n18,270\n904,590\n50\n15\n\n\nPW\nPalau\n460\n17,989\n39\n16\n\n\nSB\nSolomon Islands\n27,990\n761,215\n27\n17\n\n\nVU\nVanuatu\n12,190\n314,653\n26\n18\n\n\nPG\nPapua New Guinea\n452,860\n9,501,006\n21\n19\n\n\nNC\nNew Caledonia\n18,280\n275,315\n15\n20\n\n\nNU\nNiue\n260\n1,510\n6\n21\n\n\nPN\nPitcairn\n47\n50\n1\n22",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pocket summary comparisons among PICTs</span>"
    ]
  },
  {
    "objectID": "pocket-summary.html#birth-and-death-rates",
    "href": "pocket-summary.html#birth-and-death-rates",
    "title": "4  Pocket summary comparisons among PICTs",
    "section": "4.2 Birth and death rates",
    "text": "4.2 Birth and death rates\n\n\nShow the code\nd_rates &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Crude birth rate\", \"Crude death rate\", \"Mid-year population estimate\")) |&gt;\n  arrange(desc(time_period)) |&gt;\n  distinct(geo_pict, indicator_2, .keep_all = TRUE) |&gt;\n  select(-c(time_period, unit_mult, unit_multiplier, data_year)) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names() |&gt;\n  rename(pop = mid_year_population_estimate)\n\nd_rates |&gt;\n  ggplot(aes(crude_birth_rate, crude_death_rate)) +\n  geom_abline( lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_point(aes(size = , size = pop), \n             color = \"firebrick\", alpha = 0.3,\n             na.rm = TRUE) +\n  geom_text_repel(aes(label = place),\n                  force = 2,\n                  hjust = 0, vjust = 1,\n                  na.rm = TRUE) +\n  scale_x_continuous(\n    expand = expansion(mult = c(0.01, 0.02))\n  ) +\n  scale_y_continuous(\n    expand = expansion(mult = c(0.01, 0.02))) +\n  scale_size_continuous(range = c(1, 10),\n                        labels = comma,\n                        breaks = c(1e4, 1e5, 1e6)\n  ) +\n  expand_limits(x = 5, y = 5) +\n  labs(\n    title = \"Fiji's birth rate is in the middle of the PICT pack\",\n    subtitle = glue(\"Crude birth and death d_rates per 1000 population. 2000-2023.\",\n                    \"\\nDashed line is equal birth and death rate\",\n                    \"\\nDeath d_rates likely skewed by significant out migration\"),\n    x = \"Birth rate\",\n    y = \"Death rate\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 4.2: Crude birth and death rates",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pocket summary comparisons among PICTs</span>"
    ]
  },
  {
    "objectID": "pocket-summary.html#life-expectancy-at-birth",
    "href": "pocket-summary.html#life-expectancy-at-birth",
    "title": "4  Pocket summary comparisons among PICTs",
    "section": "4.3 Life expectancy at birth",
    "text": "4.3 Life expectancy at birth\nAmong PICTs life expectancy varies considerably, and changes since 2000 have not been universally positive–even before considering the impact of COVID-19.\n\n\nShow the code\nd_life_expectancy &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Life expectancy at birth - Male\", \n                            \"Life expectancy at birth - Female\")) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place, time_period), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names() |&gt;\n  rename(male = life_expectancy_at_birth_male,\n         female = life_expectancy_at_birth_female) |&gt;\n  mutate(place = fct_reorder(place, -female, max))\n\np1 &lt;- d_life_expectancy |&gt;\n  pivot_longer(cols = c(male, female),\n               names_to = \"metric\",\n               values_to = \"obs_value\") |&gt;\n  ggplot() +\n  geom_density_ridges(aes(x = obs_value, y = time_period, color = metric, fill = metric, group = time_period),\n                      rel_min_height = 0.005,\n                      na.rm = TRUE,\n                      linewidth = 0.15,\n                      alpha = 0.1) +\n  geom_segment(aes(x = if_else(geo_pict == \"FJ\",\n                               obs_value,\n                               NA),\n                   xend = if_else(geo_pict == \"FJ\",\n                                  obs_value,\n                                  NA),\n                   y = time_period,\n                   yend = time_period + 0.8), #\n               color = \"purple\",\n               na.rm = TRUE,\n               alpha = 1) +\n  scale_color_viridis_d(end = 0.7) +\n  scale_fill_viridis_d(end = 0.7) +\n  scale_y_continuous(expand = expansion(mult = c(0.01, 0.04))) +\n  guides(color = \"none\",\n         fill = \"none\") +\n  facet_wrap( ~ metric) +\n  labs(\n    subtitle = \"A: Changes in life expectancy distribution - all PICTs\",\n    x = \"Age\",\n    y = NULL\n  )\n\np2 &lt;- d_life_expectancy |&gt;\n  pivot_longer(cols = c(male, female),\n               names_to = \"metric\",\n               values_to = \"obs_value\") |&gt;\n  mutate(direction = case_when(\n    obs_value &gt; lag(obs_value, default = NA)   ~ \"Better\",\n    obs_value == lag(obs_value, default = NA)  ~ \"Same\",\n    obs_value &lt; lag(obs_value, default = NA)   ~ \"Worse\"),\n    .by = c(geo_pict, metric),\n    direction = if_else(is.na(direction),\n                        \"Same\",\n                        direction)\n    ) |&gt;\n  ggplot() +\n  geom_line(aes(time_period, obs_value, group = place),\n            linewidth = 0.15, alpha = 0.3) +\n  geom_line(aes(time_period, \n                if_else(geo_pict == \"FJ\",\n                        obs_value,\n                        NA),\n                group = place),\n            linewidth = 0.75, alpha = 1, color = \"purple\") +\n  geom_point(aes(time_period, obs_value, color = direction, group = place),\n            size = 1, alpha = 0.5,\n            na.rm = TRUE) +\n  scale_color_manual(values = c(\"blue\", \"darkgrey\", \"red\")) +\n  scale_x_continuous(breaks = c(2000, 2010, 2020)) +\n  scale_y_continuous(expand = expansion(mult = c(0.01, 0.04))) +\n  theme(legend.position = \"bottom\") +\n  facet_wrap( ~ metric) +\n  labs(\n    subtitle = \"B: Changes in life expectancy distribution\\neach PICT shown separately\",\n    x = NULL,\n    y = NULL\n  )\n\ndta_for_p3 &lt;- d_life_expectancy |&gt;\n  pivot_longer(cols = c(male, female),\n               names_to = \"metric\",\n               values_to = \"obs_value\") |&gt;\n  mutate(relative_obs = obs_value / obs_value[time_period == min(time_period, na.rm = TRUE) & metric == \"female\"],\n         .by = geo_pict)\n\ndta_for_p3_label &lt;- dta_for_p3 |&gt;\n  filter(time_period == max(time_period),\n         .by = geo_pict)\n\np3 &lt;- dta_for_p3 |&gt;\n  ggplot() +\n  geom_line(aes(time_period, relative_obs, group = place),\n            linewidth = 0.15, alpha = 0.3) +\n  geom_line(aes(time_period, \n                if_else(geo_pict == \"FJ\",\n                        relative_obs,\n                        NA),\n                group = place),\n            linewidth = 0.75, alpha = 0.5, color = \"purple\") +\n   geom_text_repel(data = dta_for_p3_label,\n            aes(x = time_period + 1, \n                y = relative_obs,\n                label = geo_pict),\n            hjust = 0, size = 3,\n            direction = \"x\",\n            max.overlaps = 20,\n            min.segment.length = 100, # don't draw segments\n            xlim = c(2024, 2040)\n            # check_overlap = TRUE\n  ) +\n  scale_x_continuous(breaks = c(2000, 2010, 2020)) +\n  scale_y_continuous(expand = expansion(mult = c(0.01, 0.04))) +\n  expand_limits(x = 2040) +\n  facet_wrap( ~ metric) +\n  labs(\n    subtitle = \"C. Relative change. 1.0 = Female life expectancy in first year\",\n    x = NULL,\n    y = NULL\n  )\n\np1 + p2 + p3 +\n  plot_annotation(\n    title = \"Compared to the other PICTs, Fiji life expectancy at birth is below average\",\n    subtitle = glue(\"Fiji = purple line. 2000-2023.\"),\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 4.3: Life expectancy at birth\n\n\n\n\n\n\n\n\nShow the code\ndta_label &lt;- d_life_expectancy |&gt;\n  filter(time_period == max(time_period, na.rm = TRUE),\n         .by = geo_pict)\n\nd_life_expectancy |&gt;\n  ggplot(aes(male, female)) +\n  geom_abline( lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_path(aes(color = geo_pict, group = geo_pict), \n            linewidth = 0.25, alpha = 0.5,\n            arrow = arrow(angle = 90,\n                          length = unit(4, \"mm\"), \n                          type = \"open\",\n                          ends = \"first\"),\n            na.rm = TRUE,\n            show.legend = FALSE\n            ) +\n  geom_point(aes(color = geo_pict, group = geo_pict), \n             alpha = 0.3,\n             na.rm = TRUE,\n            show.legend = FALSE) +\n  geom_point(data = dta_label,\n             aes(color = geo_pict, group = geo_pict), \n             alpha = 0.3, size = 3,\n             na.rm = TRUE,\n            show.legend = FALSE) +\n  scale_color_viridis_d(end = 0.9) +\n  # scale_fill_viridis_d(end = 0.9) +\n  facet_wrap( ~ place) + #, scales = \"free\") +\n  labs(\n    title = \"Compared to most other PICTs, Fiji life expectancy at birth hasn't changed much\",\n    subtitle = glue(\"Subplots ordered by female life expectancy. 2000-2023.\", \n                    \"\\nDashed line is equal male and female value\"),\n    x = \"Years (male)\",\n    y = \"Years (female)\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 4.4: Life expectancy at birth",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pocket summary comparisons among PICTs</span>"
    ]
  },
  {
    "objectID": "pocket-summary.html#exports-and-imports",
    "href": "pocket-summary.html#exports-and-imports",
    "title": "4  Pocket summary comparisons among PICTs",
    "section": "4.4 Exports and imports",
    "text": "4.4 Exports and imports\nMost PICTs import significantly more than they export; the biggest exceptions (PNG, Solomon Islands) export a lot of natural resources.\n\n\nShow the code\nd_export_import_latest_year &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Exports\", \"Imports\", \"Mid-year population estimate\")) |&gt;\n  arrange(desc(time_period)) |&gt;\n  distinct(geo_pict, indicator_2, .keep_all = TRUE) |&gt;\n  select(-c(unit_mult, unit_multiplier, data_year)) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place, time_period), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names() |&gt;\n  rename(pop = mid_year_population_estimate) |&gt;\n  mutate(across(c(exports, imports), function(x) na_if(x, 0)),\n         time_period = factor(time_period),\n         # data repair\n         exports = if_else(geo_pict == \"AS\" & time_period %in% c(2017, 2018, 2019),\n                          exports * 1000,\n                          exports),\n         imports = if_else(geo_pict == \"AS\" & time_period %in% c(2017, 2018, 2019),\n                          imports * 1000,\n                          imports),\n         ) |&gt;\n  filter(geo_pict != \"TK\") # no data\n\nd_export_import_latest_year |&gt;\n  ggplot(aes(1000 * (exports + 1), 1000 * (imports + 1))) +\n  geom_abline( lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_point(aes(size = , size = pop), \n             color = \"firebrick\", alpha = 0.3,\n             na.rm = TRUE) +\n  geom_text_repel(aes(label = place),\n                  force = 2,\n                  hjust = 0, vjust = 1,\n                  na.rm = TRUE) +\n  scale_x_log10(\n    label = label_number(scale_cut = cut_short_scale()),\n    expand = expansion(mult = c(0.01, 0.04))\n  ) +\n  scale_y_log10(\n    label = label_number(scale_cut = cut_short_scale()),\n    expand = expansion(mult = c(0.01, 0.04))) +\n  scale_size_continuous(range = c(1, 10),\n                        labels = comma,\n                        breaks = c(1e4, 1e5, 1e6)\n  ) +\n  expand_limits(x = 1e6, y = 1e6) +\n  labs(\n    title = \"Fiji is among the top 3 PICTs for exports and imports\",\n    subtitle = glue(\"Exports and Imports (USD). 2023.\",\n                    \"\\nDashed line is equal export and import value\"),\n    \n    x = \"Exports (log10 scale)\",\n    y = \"Imports (log10 scale)\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 4.5: Exports and imports in USD - latest year available\n\n\n\n\n\nMost PICTs importing good worth at least USD100M annually, import and export value (or rate of growth) varies within a small range. The big exceptions (see the long trails in Figure 4.6) are the following:\n\nPapua New Guinea, where petroleum and mining are the source of most export value.\nThe Northern Mariana Islands, where the significant drop in exports likely is due to the garment industry drying up.2\nSolomon Islands, where imports and exports grew dramatically, possible due to foreign investment in mining and other resource extractive industries.3\n\n\n\nShow the code\nset1_geo_pict &lt;- c(\"NU\", \"NR\", \"PN\", \"WF\", \"TV\")\n\nd_export_import_all_years &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Exports\", \"Imports\", \"Mid-year population estimate\")) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place, time_period), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names() |&gt;\n  filter(exports != 0,\n         imports != 0) |&gt;\n  rename(pop = mid_year_population_estimate) |&gt;\n  mutate(exports = if_else(geo_pict == \"AS\" & time_period %in% c(2017, 2018, 2019),\n                          exports * 1000,\n                          exports),\n         imports = if_else(geo_pict == \"AS\" & time_period %in% c(2017, 2018, 2019),\n                          imports * 1000,\n                          imports),\n         ) |&gt;\n  filter(geo_pict != \"TK\") # no data\n\ndta_label &lt;- d_export_import_all_years |&gt;\n  filter(time_period == max(time_period, na.rm = TRUE),\n         .by = geo_pict)\n\ndta_last_point &lt;- d_export_import_all_years |&gt;\n  filter(time_period == max(time_period, na.rm = TRUE),\n         .by = geo_pict)\n\np2 &lt;- d_export_import_all_years |&gt;\n  filter(!geo_pict %in% set1_geo_pict) |&gt;\n  ggplot(aes(exports, imports)) +\n  geom_abline( lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_path(aes(color = geo_pict), \n            linewidth = 0.25, alpha = 0.5,\n            arrow = arrow(angle = 90,\n                          length = unit(4, \"mm\"), \n                          type = \"open\",\n                          ends = \"first\"),\n            na.rm = TRUE,\n            show.legend = FALSE\n            ) +\n  geom_point(aes(size = pop, color = geo_pict, group = geo_pict),\n             alpha = 0.3,\n             na.rm = TRUE,\n            show.legend = TRUE) +\n  geom_point(data = dta_last_point |&gt;\n               filter(!geo_pict %in% set1_geo_pict),\n             aes(color = geo_pict, group = geo_pict, size = pop), \n             # alpha = 0.3,\n             na.rm = TRUE,\n            show.legend = FALSE) +\n  geom_point(data = dta_last_point |&gt;\n               filter(!geo_pict %in% set1_geo_pict),\n             aes(group = geo_pict, size = pop * 0.25), \n             color = \"white\", #alpha = 0.3, \n             na.rm = TRUE,\n            show.legend = FALSE) +\n  geom_text_repel(data = dta_label|&gt;\n                    filter(!geo_pict %in% set1_geo_pict),\n                  aes(color = geo_pict, label = place),\n                  hjust = 0, vjust = 1,\n                  force = 2,\n                  na.rm = TRUE,\n            show.legend = FALSE) +\n  scale_x_log10(\n    label = label_number(scale = 1e-3),\n    expand = expansion(mult = c(0.01, 0.02)),\n    breaks = 1000* 10^c(-1:3)\n  ) +\n  scale_y_log10(\n    label = label_number(scale = 1e-3),\n    expand = expansion(mult = c(0.01, 0.02))\n    ) +\n  scale_size_continuous(range = c(1, 10),\n                        labels = comma,\n                        breaks = c(1e4, 1e5, 1e6, 9e6)\n  ) +\n  scale_color_viridis_d(end = 0.9) +\n  guides(size = guide_legend(position = \"inside\"),\n         color = \"none\") +\n  theme(legend.position.inside = c(0.8, 0.2)) +\n  labs(\n    subtitle = \"PICTs with imports &gt; $100M*\",\n    x = \"Exports $M (log10 scale)\",\n    y = \"Imports $M (log10 scale)\"\n  )\n\n#p1 + \np2 +\n  plot_annotation(\n    title = \"Imports by exports (millions USD)\",\n    subtitle = glue(\"2000-2023. Dashed line is equal export and import value\"),\n    caption = glue(my_caption,\n                   \"\\n*Imports &gt; $100M at least some years, excluding Nauru for which imports varied wildly\")\n  )\n\n\n\n\n\n\n\n\nFigure 4.6: Exports and imports in USD\n\n\n\n\n\n\nFigure 4.7 presents the same data faceted by PICT, which makes each PICT’s pattern of exports and imports over the years more visible.\n\n\nShow the code\nd_export_import_all_years &lt;- d_pocket |&gt;\n  filter(indicator_2 %in% c(\"Exports\", \"Imports\", \"Mid-year population estimate\"),\n         obs_value != 0) |&gt;\n  pivot_wider(id_cols = c(geo_pict, place, time_period), \n              names_from = indicator_2, values_from = obs_value) |&gt;\n  clean_names() |&gt;\n  rename(pop = mid_year_population_estimate) |&gt;\n  mutate(across(c(exports, imports), function(x) na_if(x, 0)),\n         # data repair\n         exports = if_else(geo_pict == \"AS\" & time_period %in% c(2017, 2018, 2019),\n                          exports * 1000,\n                          exports),\n         imports = if_else(geo_pict == \"AS\" & time_period %in% c(2017, 2018, 2019),\n                          imports * 1000,\n                          imports),\n         ) |&gt;\n  filter(geo_pict != \"TK\",\n         !is.na(exports),\n         !is.na(imports),\n         !is.na(pop)) |&gt; # no data\n  mutate(place = fct_reorder(place, -pop, max))\n\nd_export_import_all_years |&gt;\n  ggplot(aes(exports, imports)) +\n  geom_abline(lty = 2, linewidth = 0.15, alpha = 0.3) +\n  geom_path(linewidth = 0.25, alpha = 0.5,\n             na.rm = TRUE) +\n  geom_point(aes(color = time_period, size = pop, group = geo_pict), \n             alpha = 0.3,\n             na.rm = TRUE) +\n  scale_x_continuous(\n    label = label_number(scale = 1e-3,\n                         big.mark = \",\"),\n  ) +\n  scale_y_continuous(\n    label = label_number(scale = 1e-3,\n                         big.mark = \",\"),\n    ) +\n  scale_size_continuous(range = c(1, 10),\n                        labels = comma,\n                        breaks = c(1e4, 1e5, 1e6, 9e6)\n  ) +\n  scale_color_viridis_c(end = 0.95) +\n  facet_wrap(~ place, scales = \"free\") + #\n  labs(\n    title = \"Imports by exports (millions USD)\",\n    subtitle = glue(\"Subplots ordered by population. X and Y axis scales vary. 2000-2023.\", \n                    \"\\nDashed line is equal export and import value.\"),\n    x = \"Exports $M\",\n    y = \"Imports $M\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 4.7: Exports and imports in USD",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pocket summary comparisons among PICTs</span>"
    ]
  },
  {
    "objectID": "pocket-summary.html#available-metrics",
    "href": "pocket-summary.html#available-metrics",
    "title": "4  Pocket summary comparisons among PICTs",
    "section": "4.5 Available metrics",
    "text": "4.5 Available metrics\nThe pocket summary includes metrics not explored above. I list them all below, in case you wish to dig into them yourself:\n\n\nShow the code\nd_pocket |&gt;\n  summarize(\n    n_countries = n_distinct(geo_pict),\n    .by = c(indicator, indicator_2)\n  ) |&gt;\n  arrange(indicator) |&gt;\n  mutate(idx = row_number()) |&gt;\n  gt() |&gt;\n  tab_header(md(\"**Metrics in 'pocket summary' dataset from the SPC**\")) |&gt;\n  tab_options(table.font.size = 10)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nMetrics in ‘pocket summary’ dataset from the SPC\n\n\nindicator\nindicator_2\nn_countries\nidx\n\n\n\n\nCBR\nCrude birth rate\n21\n1\n\n\nCDR\nCrude death rate\n21\n2\n\n\nDEPRATIO\nDependency Ratio (15-59)\n21\n3\n\n\nEEZ\nEEZ area\n22\n4\n\n\nEXPUSD\nExports\n22\n5\n\n\nGDPCDOM\nGDP, current prices, in local currency units\n22\n6\n\n\nGDPCPCUSD\nGDP, per capita, in USD\n22\n7\n\n\nGDPCUSD\nGDP, current price, in USD\n22\n8\n\n\nGOVEXPGDPC\nGoverment revenue as percent of GDP (current prices)\n18\n9\n\n\nGOVREVGDPC\nGoverment expenditure as percent of GDP (current prices)\n20\n10\n\n\nHGT\nMax height above sea level\n22\n11\n\n\nIMPUSD\nImports\n22\n12\n\n\nIMR\nInfant mortality rate\n21\n13\n\n\nINFRATE\nInflation rate\n21\n14\n\n\nLAR\nLand area\n22\n15\n\n\nLEBF\nLife expectancy at birth - Female\n21\n16\n\n\nLEBM\nLife expectancy at birth - Male\n21\n17\n\n\nMEDIANAGE\nMedian age\n21\n18\n\n\nMIDYEARPOPEST\nMid-year population estimate\n22\n19\n\n\nOSV\nOverseas Visitors\n21\n20\n\n\nPOPCHILD\nChildren (&lt;14)\n21\n21\n\n\nPOPDENS\nPopulation density\n22\n22\n\n\nPOPELDER\nElderly (60+)\n21\n23\n\n\nPOPYGR\nAnnual growth rate\n22\n24\n\n\nPOPYOUTH\nYouth (15-24)\n21\n25\n\n\nTFR\nTotal fertility rate\n21\n26\n\n\nTNFR\nTeenage fertility rate (15-19)\n21\n27\n\n\nTRADEBALUSD\nTrade balance\n22\n28",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pocket summary comparisons among PICTs</span>"
    ]
  },
  {
    "objectID": "pocket-summary.html#footnotes",
    "href": "pocket-summary.html#footnotes",
    "title": "4  Pocket summary comparisons among PICTs",
    "section": "",
    "text": "The pocket summary presents a consolidated view of a set of key figures for Pacific island countries and territories (PICTs). Pocket summary (latest available value per year). Identifier: SPC:DF_POCKET(3.0), Modified: 2023-12-20, Temporal Coverage From: 2000-01-01, Temporal Coverage To: 2023-12-31, Publisher Name: SPC https://pacificdata.org/data/dataset/pocket-summary-latest-available-value-per-year-df-pocket Downloaded 2024-06-16↩︎\nhttps://en.wikipedia.org/wiki/Economy_of_the_Northern_Mariana_Islands ↩︎\nhttps://en.wikipedia.org/wiki/Economy_of_Solomon_Islands ↩︎",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pocket summary comparisons among PICTs</span>"
    ]
  },
  {
    "objectID": "who-indicators.html",
    "href": "who-indicators.html",
    "title": "5  WHO indicators",
    "section": "",
    "text": "5.1 Healthy life expectancy at birth (HALE)\nHealthy life expectancy at birth is the “average number of years that a person can expect to live in “full health” from birth.”1.\nThere are some common patterns\nUnfortunately Fiji did not experience the same level of improvements.\nThese patterns are visible in Figure 5.1, which compares Fiji, France and USA.\nShow the code\nhale |&gt;\n  filter(spatial_dim %in% c(\"FJI\", \"USA\", \"FRA\")) |&gt;\n  ggplot() +\n  geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = dim1),\n              alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = dim1)) +\n  facet_wrap(~spatial_dim) +\n  labs(\n    title = \"Fiji, France, USA: Healthy life expectancy at birth (HALE)\",\n    x = NULL,\n    y = \"Age\",\n    color = NULL,\n    fill = NULL,\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\n\n\n\n\n\n\n\nFigure 5.1: Comparing Fiji’s Healthy life expectancy at birth (HALE) to France and USA\nFiji is in the World Bank upper middle income group (WB_UMI: GNI per capita USD 4,516 TO 14,005 in 2023).3 In 2000, Fiji was already a lagging HALE outlier, and while the upper middle income group improved over two decades, Fiji’s HALE remained essentially unchanged, making the gap even larger (Figure 5.2).\nShow the code\ndta_for_plot &lt;- hale |&gt;\n  filter(spatial_dim_type == \"WORLDBANKINCOMEGROUP\" | (spatial_dim_type == \"COUNTRY\" & spatial_dim == \"FJI\"),\n         dim1 == \"SEX_BTSX\") |&gt;\n  mutate(spatial_dim = factor(spatial_dim, levels = c(\"WB_LI\", \"WB_LMI\", \"WB_UMI\", \"WB_HI\", \"FJI\"))) |&gt;\n  mutate(numeric_value_norm = numeric_value / numeric_value[time_dim == 2000],\n         low_norm = low / low[time_dim == 2000],\n         high_norm = high / high[time_dim == 2000],\n         .by = spatial_dim)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = spatial_dim),\n              alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = spatial_dim)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  # facet_wrap(~spatial_dim) +\n  labs(\n    # title = glue(\"Fiji has not been improving in 'healthy life expectancy at birth' (HALE)\",\n    #              \"\\ncompared to World Bank income groups\"),\n    subtitle = \"A: Fiji is an outlier in the UMI group\",\n    x = NULL,\n    y = \"Age\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\",\n    # caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_ribbon(aes(x = time_dim, ymin = low_norm, ymax = high_norm, fill = spatial_dim),\n              alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value_norm, color = spatial_dim)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent()) +\n  # facet_wrap(~spatial_dim) +\n  labs(\n    subtitle = \"B: Relative to year 2000 = 100%\",\n    x = NULL,\n    y = \"Relative improvement in age\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\"\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Fiji has not been improving in 'healthy life expectancy at birth' (HALE)\",\n                 \"\\ncompared to World Bank income groups\"),\n    subtitle = \"Both sexes\",\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  ) +\n  plot_layout(guides = \"collect\")\n\n\n\n\n\n\n\n\nFigure 5.2: HALE: Fiji and World Bank income groups\nTODO: Plot other WB_UMI countries together with Fiji\nTODO: Plot other PICTs together with Fiji",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#healthy-life-expectancy-at-birth-hale",
    "href": "who-indicators.html#healthy-life-expectancy-at-birth-hale",
    "title": "5  WHO indicators",
    "section": "",
    "text": "Women have a longer HALE than men in most countries.\nThe COVID-19 pandemic reduced HALE for most countries and both sexes.\n“Worldwide, healthy life expectancy at birth (years) has improved by ▲ 3.57 years from 58.3 years in 2000 to 61.9 years in 2021.”2.",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#diabetes",
    "href": "who-indicators.html#diabetes",
    "title": "5  WHO indicators",
    "section": "5.2 Diabetes",
    "text": "5.2 Diabetes\n\n\nShow the code\n# Age-standardized death rates, diabetes mellitus, per 100,000\n\ndiabetes_long &lt;- diabetes |&gt;\n  pivot_longer(cols = dim1,\n               #names_to = \"sex\",\n               values_to = \"sex_value\")\n\ndiabetes_wide &lt;- diabetes_long |&gt;\n  pivot_wider(#cols = dim1,\n               names_from = sex_value,\n               values_from = numeric_value) |&gt;\n  mutate(rank_val = rank(SEX_BTSX, ties.method = \"max\"),\n         spatial_dim_label = glue(\"{spatial_dim}: {rank_val}\"),\n         spatial_dim_label = fct_reorder(spatial_dim_label, rank_val)) |&gt;\n  mutate(pct_SEX_MLE = SEX_MLE / 1e5,\n         pct_SEX_FMLE = SEX_FMLE / 1e5,\n         pct_SEX_BTSX = SEX_BTSX / 1e5,)\n\n# why only 2004 data?\n\n\n\n\nShow the code\nrank_min &lt;- min(diabetes_wide$rank_val)\nrank_max &lt;- max(diabetes_wide$rank_val)\n\ndiabetes_wide |&gt;\n  ggplot() +\n  geom_errorbarh(aes(y = spatial_dim_label, xmin = SEX_MLE, , xmax = SEX_FMLE, color = parent_location),\n            linewidth = 0.1, height = 0, alpha = 0.8,\n            show.legend = FALSE) +\n  geom_point(aes(y = spatial_dim_label, x = SEX_BTSX, color = parent_location),\n            size = 1, alpha = 0.8,\n            show.legend = FALSE) +\n  geom_point(aes(y = spatial_dim_label, x = SEX_MLE, color = parent_location),\n            size = 3, alpha = 0.8, shape = \"M\",\n            show.legend = FALSE) +\n  geom_point(aes(y = spatial_dim_label, x = SEX_FMLE, color = parent_location),\n            size = 3, alpha = 0.8, shape = \"F\",\n            show.legend = FALSE) +\n  # scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  facet_wrap(~parent_location, scales = \"free_y\") +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    title = glue(\"Age-standardized death rates, diabetes mellitus, per 100,000 people (2004)\"),\n    subtitle = glue(\"With country rank lowest (1) to highest ({rank_max}) death rate\",\n                    \"\\nShowing M, F, and both sexes (the later with a point)\"),\n    x = NULL,\n    y = NULL,\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\n\n\n\n\n\n\n\nFigure 5.3: Diabetes 2004\n\n\n\n\n\n\n\n\nShow the code\n# rank_min &lt;- min(diabetes_wide$rank_val)\n# rank_max &lt;- max(diabetes_wide$rank_val)\n\ndta_for_plot_labels &lt;- tribble(\n  ~parent_location,          ~x,    ~y,\n  \"Africa\",                  65,   0.027,\n  \"Americas\",                90,   0.007,\n  \"Eastern Mediterranean\",   30,   0.023,\n  \"Europe\",                  15,   0.065,\n  \"South-East Asia\",         36,   0.05,\n  \"Western Pacific\",         58,   0.015,\n)\n\ndta_for_plot &lt;- diabetes_long |&gt;\n  filter(sex_value == \"SEX_BTSX\")\n\necdf_fun &lt;- ecdf(\n  dta_for_plot |&gt;\n  filter(parent_location == \"Western Pacific\") |&gt;\n  pull(numeric_value)\n  )\n\nfiji_value &lt;- dta_for_plot |&gt;\n    filter(spatial_dim == \"FJI\") |&gt;\n    pull(numeric_value)\n\nfiji_percentile &lt;- ecdf_fun(fiji_value)\n\necdf_fun_americas &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Americas\") |&gt;\n    pull(numeric_value)\n)\n\nusa_value &lt;- dta_for_plot |&gt;\n    filter(spatial_dim == \"USA\") |&gt;\n    pull(numeric_value)\n\nusa_percentile &lt;- ecdf_fun_americas(usa_value)\n\necdf_fun_europe &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Europe\") |&gt;\n    pull(numeric_value)\n)\n\nfra_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Europe\",\n           spatial_dim == \"FRA\") |&gt;\n    pull(numeric_value)\n\nfra_percentile &lt;- ecdf_fun_europe(fra_value)\n\np1 &lt;- diabetes_long |&gt;\n  ggplot() +\n   geom_density(aes(x = numeric_value, color = parent_location),\n            linewidth = 0.6, alpha = 0.8,\n            show.legend = FALSE) +\n  geom_text(data = dta_for_plot_labels,\n            aes(x, y, label = parent_location, color = parent_location),\n            hjust = 0, nudge_x = 1, size = 4, \n            show.legend = FALSE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(#labels = label_percent(),\n                     expand = expansion(mult = c(0.002, 0))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Density\",\n    x = \"People per 100K\",\n    y = NULL,\n    # caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\np2 &lt;- diabetes_long |&gt;\n  ggplot() +\n  stat_ecdf(aes(x = numeric_value, color = parent_location),\n            linewidth = 0.6, alpha = 0.8,\n            pad = FALSE,\n            show.legend = FALSE) +\n  annotate(\"point\", x = fiji_value, y = fiji_percentile) +\n  annotate(\"label\", x = fiji_value + 5, y = fiji_percentile, label = \"Republic of Fiji\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = usa_value, y = usa_percentile) +\n  annotate(\"label\", x = usa_value + 3, y = usa_percentile, label = \"USA\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = fra_value, y = fra_percentile) +\n  annotate(\"label\", x = fra_value + 3, y = fra_percentile, label = \"France\",\n            hjust = 0, size = 4) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(mult = c(0.002, 0))) +\n  # facet_wrap(~parent_location, scales = \"free_y\") +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Cumulative Distribution\",\n    x = \"People per 100K\",\n    y = \"Percent of all countries in region\"\n    \n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Age-standardized death rates, diabetes mellitus, per 100,000 people (2004)\"),\n    subtitle = glue(\"Both sexes, country distribution, by region\"),\n    caption = glue(\"Daniel Moul. Source: WHO GHO\",\n                   \"\\n(not weighted by population)\")\n  )\n\n\n\n\n\n\n\n\nFigure 5.4: Diabetes 2004 by region\n\n\n\n\n\nTODO: Why isn’t the USA point on the Americas line?",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#section",
    "href": "who-indicators.html#section",
    "title": "5  WHO indicators",
    "section": "5.3 ",
    "text": "5.3 \n\n\nShow the code\ndiabetes_wide |&gt;\n  left_join(ISO_3166_1,\n            by = join_by(spatial_dim == Alpha_3)\n  ) |&gt;\n  select(country_code = spatial_dim, Name,  Official_name, region = parent_location, rank_val) |&gt;\n  arrange(country_code) |&gt;\n  gt() |&gt;\n  tab_header(md(\"**ISO 3166 three-letter country codes explained**\")) |&gt;\n  tab_options(table.font.size = 10) |&gt;\n  sub_missing()\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nISO 3166 three-letter country codes explained\n\n\ncountry_code\nName\nOfficial_name\nregion\nrank_val\n\n\n\n\nAFG\nAfghanistan\nIslamic Republic of Afghanistan\nEastern Mediterranean\n86\n\n\nAGO\nAngola\nRepublic of Angola\nAfrica\n176\n\n\nALB\nAlbania\nRepublic of Albania\nEurope\n22\n\n\nAND\nAndorra\nPrincipality of Andorra\nEurope\n24\n\n\nARE\nUnited Arab Emirates\n—\nEastern Mediterranean\n81\n\n\nARG\nArgentina\nArgentine Republic\nAmericas\n66\n\n\nARM\nArmenia\nRepublic of Armenia\nEurope\n177\n\n\nATG\nAntigua and Barbuda\n—\nAmericas\n188\n\n\nAUS\nAustralia\n—\nWestern Pacific\n31\n\n\nAUT\nAustria\nRepublic of Austria\nEurope\n65\n\n\nAZE\nAzerbaijan\nRepublic of Azerbaijan\nEurope\n79\n\n\nBDI\nBurundi\nRepublic of Burundi\nAfrica\n165\n\n\nBEL\nBelgium\nKingdom of Belgium\nEurope\n20\n\n\nBEN\nBenin\nRepublic of Benin\nAfrica\n146\n\n\nBFA\nBurkina Faso\n—\nAfrica\n155\n\n\nBGD\nBangladesh\nPeople's Republic of Bangladesh\nSouth-East Asia\n77\n\n\nBGR\nBulgaria\nRepublic of Bulgaria\nEurope\n45\n\n\nBHR\nBahrain\nKingdom of Bahrain\nEastern Mediterranean\n182\n\n\nBHS\nBahamas\nCommonwealth of the Bahamas\nAmericas\n125\n\n\nBIH\nBosnia and Herzegovina\nRepublic of Bosnia and Herzegovina\nEurope\n39\n\n\nBLR\nBelarus\nRepublic of Belarus\nEurope\n5\n\n\nBLZ\nBelize\n—\nAmericas\n169\n\n\nBOL\nBolivia, Plurinational State of\nPlurinational State of Bolivia\nAmericas\n98\n\n\nBRA\nBrazil\nFederative Republic of Brazil\nAmericas\n108\n\n\nBRB\nBarbados\n—\nAmericas\n150\n\n\nBRN\nBrunei Darussalam\n—\nWestern Pacific\n149\n\n\nBTN\nBhutan\nKingdom of Bhutan\nSouth-East Asia\n69\n\n\nBWA\nBotswana\nRepublic of Botswana\nAfrica\n105\n\n\nCAF\nCentral African Republic\n—\nAfrica\n151\n\n\nCAN\nCanada\n—\nAmericas\n50\n\n\nCHE\nSwitzerland\nSwiss Confederation\nEurope\n29\n\n\nCHL\nChile\nRepublic of Chile\nAmericas\n73\n\n\nCHN\nChina\nPeople's Republic of China\nWestern Pacific\n34\n\n\nCIV\nCôte d'Ivoire\nRepublic of Côte d'Ivoire\nAfrica\n155\n\n\nCMR\nCameroon\nRepublic of Cameroon\nAfrica\n144\n\n\nCOD\nCongo, The Democratic Republic of the\n—\nAfrica\n163\n\n\nCOG\nCongo\nRepublic of the Congo\nAfrica\n123\n\n\nCOK\nCook Islands\n—\nWestern Pacific\n105\n\n\nCOL\nColombia\nRepublic of Colombia\nAmericas\n92\n\n\nCOM\nComoros\nUnion of the Comoros\nAfrica\n176\n\n\nCPV\nCabo Verde\nRepublic of Cabo Verde\nAfrica\n158\n\n\nCRI\nCosta Rica\nRepublic of Costa Rica\nAmericas\n90\n\n\nCUB\nCuba\nRepublic of Cuba\nAmericas\n41\n\n\nCYP\nCyprus\nRepublic of Cyprus\nEurope\n3\n\n\nCZE\nCzechia\nCzech Republic\nEurope\n18\n\n\nDEU\nGermany\nFederal Republic of Germany\nEurope\n43\n\n\nDJI\nDjibouti\nRepublic of Djibouti\nEastern Mediterranean\n60\n\n\nDMA\nDominica\nCommonwealth of Dominica\nAmericas\n141\n\n\nDNK\nDenmark\nKingdom of Denmark\nEurope\n47\n\n\nDOM\nDominican Republic\n—\nAmericas\n158\n\n\nDZA\nAlgeria\nPeople's Democratic Republic of Algeria\nAfrica\n100\n\n\nECU\nEcuador\nRepublic of Ecuador\nAmericas\n114\n\n\nEGY\nEgypt\nArab Republic of Egypt\nEastern Mediterranean\n64\n\n\nERI\nEritrea\nthe State of Eritrea\nAfrica\n115\n\n\nESP\nSpain\nKingdom of Spain\nEurope\n32\n\n\nEST\nEstonia\nRepublic of Estonia\nEurope\n40\n\n\nETH\nEthiopia\nFederal Democratic Republic of Ethiopia\nAfrica\n143\n\n\nFIN\nFinland\nRepublic of Finland\nEurope\n12\n\n\nFJI\nFiji\nRepublic of Fiji\nWestern Pacific\n112\n\n\nFRA\nFrance\nFrench Republic\nEurope\n26\n\n\nFSM\nMicronesia, Federated States of\nFederated States of Micronesia\nWestern Pacific\n120\n\n\nGAB\nGabon\nGabonese Republic\nAfrica\n116\n\n\nGBR\nUnited Kingdom\nUnited Kingdom of Great Britain and Northern Ireland\nEurope\n11\n\n\nGEO\nGeorgia\n—\nEurope\n27\n\n\nGHA\nGhana\nRepublic of Ghana\nAfrica\n71\n\n\nGIN\nGuinea\nRepublic of Guinea\nAfrica\n147\n\n\nGMB\nGambia\nRepublic of the Gambia\nAfrica\n134\n\n\nGNB\nGuinea-Bissau\nRepublic of Guinea-Bissau\nAfrica\n159\n\n\nGNQ\nEquatorial Guinea\nRepublic of Equatorial Guinea\nAfrica\n164\n\n\nGRC\nGreece\nHellenic Republic\nEurope\n8\n\n\nGRD\nGrenada\n—\nAmericas\n180\n\n\nGTM\nGuatemala\nRepublic of Guatemala\nAmericas\n122\n\n\nGUY\nGuyana\nRepublic of Guyana\nAmericas\n189\n\n\nHND\nHonduras\nRepublic of Honduras\nAmericas\n173\n\n\nHRV\nCroatia\nRepublic of Croatia\nEurope\n36\n\n\nHTI\nHaiti\nRepublic of Haiti\nAmericas\n174\n\n\nHUN\nHungary\nHungary\nEurope\n43\n\n\nIDN\nIndonesia\nRepublic of Indonesia\nSouth-East Asia\n96\n\n\nIND\nIndia\nRepublic of India\nSouth-East Asia\n71\n\n\nIRL\nIreland\n—\nEurope\n21\n\n\nIRN\nIran, Islamic Republic of\nIslamic Republic of Iran\nEastern Mediterranean\n55\n\n\nIRQ\nIraq\nRepublic of Iraq\nEastern Mediterranean\n62\n\n\nISL\nIceland\nRepublic of Iceland\nEurope\n6\n\n\nISR\nIsrael\nState of Israel\nEurope\n94\n\n\nITA\nItaly\nItalian Republic\nEurope\n38\n\n\nJAM\nJamaica\n—\nAmericas\n101\n\n\nJOR\nJordan\nHashemite Kingdom of Jordan\nEastern Mediterranean\n88\n\n\nJPN\nJapan\n—\nWestern Pacific\n7\n\n\nKAZ\nKazakhstan\nRepublic of Kazakhstan\nEurope\n33\n\n\nKEN\nKenya\nRepublic of Kenya\nAfrica\n122\n\n\nKGZ\nKyrgyzstan\nKyrgyz Republic\nEurope\n38\n\n\nKHM\nCambodia\nKingdom of Cambodia\nWestern Pacific\n126\n\n\nKIR\nKiribati\nRepublic of Kiribati\nWestern Pacific\n186\n\n\nKNA\nSaint Kitts and Nevis\n—\nAmericas\n83\n\n\nKOR\nKorea, Republic of\n—\nWestern Pacific\n93\n\n\nKWT\nKuwait\nState of Kuwait\nEastern Mediterranean\n113\n\n\nLAO\nLao People's Democratic Republic\n—\nWestern Pacific\n73\n\n\nLBN\nLebanon\nLebanese Republic\nEastern Mediterranean\n53\n\n\nLBR\nLiberia\nRepublic of Liberia\nAfrica\n162\n\n\nLBY\nLibya\nLibya\nEastern Mediterranean\n52\n\n\nLCA\nSaint Lucia\n—\nAmericas\n187\n\n\nLKA\nSri Lanka\nDemocratic Socialist Republic of Sri Lanka\nSouth-East Asia\n106\n\n\nLSO\nLesotho\nKingdom of Lesotho\nAfrica\n103\n\n\nLTU\nLithuania\nRepublic of Lithuania\nEurope\n11\n\n\nLUX\nLuxembourg\nGrand Duchy of Luxembourg\nEurope\n16\n\n\nLVA\nLatvia\nRepublic of Latvia\nEurope\n13\n\n\nMAR\nMorocco\nKingdom of Morocco\nEastern Mediterranean\n50\n\n\nMCO\nMonaco\nPrincipality of Monaco\nEurope\n15\n\n\nMDA\nMoldova, Republic of\nRepublic of Moldova\nEurope\n20\n\n\nMDG\nMadagascar\nRepublic of Madagascar\nAfrica\n130\n\n\nMDV\nMaldives\nRepublic of Maldives\nSouth-East Asia\n172\n\n\nMEX\nMexico\nUnited Mexican States\nAmericas\n179\n\n\nMHL\nMarshall Islands\nRepublic of the Marshall Islands\nWestern Pacific\n168\n\n\nMKD\nNorth Macedonia\nRepublic of North Macedonia\nEurope\n80\n\n\nMLI\nMali\nRepublic of Mali\nAfrica\n166\n\n\nMLT\nMalta\nRepublic of Malta\nEurope\n51\n\n\nMMR\nMyanmar\nRepublic of Myanmar\nSouth-East Asia\n84\n\n\nMNG\nMongolia\n—\nWestern Pacific\n2\n\n\nMOZ\nMozambique\nRepublic of Mozambique\nAfrica\n131\n\n\nMRT\nMauritania\nIslamic Republic of Mauritania\nAfrica\n133\n\n\nMUS\nMauritius\nRepublic of Mauritius\nAfrica\n128\n\n\nMWI\nMalawi\nRepublic of Malawi\nAfrica\n136\n\n\nMYS\nMalaysia\n—\nWestern Pacific\n99\n\n\nNAM\nNamibia\nRepublic of Namibia\nAfrica\n95\n\n\nNER\nNiger\nRepublic of the Niger\nAfrica\n167\n\n\nNGA\nNigeria\nFederal Republic of Nigeria\nAfrica\n153\n\n\nNIC\nNicaragua\nRepublic of Nicaragua\nAmericas\n179\n\n\nNIU\nNiue\nNiue\nWestern Pacific\n108\n\n\nNLD\nNetherlands\nKingdom of the Netherlands\nEurope\n44\n\n\nNOR\nNorway\nKingdom of Norway\nEurope\n17\n\n\nNPL\nNepal\nFederal Democratic Republic of Nepal\nSouth-East Asia\n91\n\n\nNRU\nNauru\nRepublic of Nauru\nWestern Pacific\n183\n\n\nNZL\nNew Zealand\n—\nWestern Pacific\n46\n\n\nOMN\nOman\nSultanate of Oman\nEastern Mediterranean\n160\n\n\nPAK\nPakistan\nIslamic Republic of Pakistan\nEastern Mediterranean\n69\n\n\nPAN\nPanama\nRepublic of Panama\nAmericas\n102\n\n\nPER\nPeru\nRepublic of Peru\nAmericas\n69\n\n\nPHL\nPhilippines\nRepublic of the Philippines\nWestern Pacific\n87\n\n\nPLW\nPalau\nRepublic of Palau\nWestern Pacific\n143\n\n\nPNG\nPapua New Guinea\nIndependent State of Papua New Guinea\nWestern Pacific\n90\n\n\nPOL\nPoland\nRepublic of Poland\nEurope\n26\n\n\nPRK\nKorea, Democratic People's Republic of\nDemocratic People's Republic of Korea\nSouth-East Asia\n86\n\n\nPRT\nPortugal\nPortuguese Republic\nEurope\n74\n\n\nPRY\nParaguay\nRepublic of Paraguay\nAmericas\n182\n\n\nQAT\nQatar\nState of Qatar\nEastern Mediterranean\n184\n\n\nROU\nRomania\n—\nEurope\n14\n\n\nRUS\nRussian Federation\n—\nEurope\n11\n\n\nRWA\nRwanda\nRwandese Republic\nAfrica\n152\n\n\nSAU\nSaudi Arabia\nKingdom of Saudi Arabia\nEastern Mediterranean\n162\n\n\nSDN\nSudan\nRepublic of the Sudan\nEastern Mediterranean\n109\n\n\nSEN\nSenegal\nRepublic of Senegal\nAfrica\n141\n\n\nSGP\nSingapore\nRepublic of Singapore\nWestern Pacific\n31\n\n\nSLB\nSolomon Islands\n—\nWestern Pacific\n119\n\n\nSLE\nSierra Leone\nRepublic of Sierra Leone\nAfrica\n171\n\n\nSLV\nEl Salvador\nRepublic of El Salvador\nAmericas\n97\n\n\nSMR\nSan Marino\nRepublic of San Marino\nEurope\n1\n\n\nSOM\nSomalia\nFederal Republic of Somalia\nEastern Mediterranean\n124\n\n\nSTP\nSao Tome and Principe\nDemocratic Republic of Sao Tome and Principe\nAfrica\n137\n\n\nSUR\nSuriname\nRepublic of Suriname\nAmericas\n129\n\n\nSVK\nSlovakia\nSlovak Republic\nEurope\n29\n\n\nSVN\nSlovenia\nRepublic of Slovenia\nEurope\n56\n\n\nSWE\nSweden\nKingdom of Sweden\nEurope\n23\n\n\nSWZ\nEswatini\nKingdom of Eswatini\nAfrica\n117\n\n\nSYC\nSeychelles\nRepublic of Seychelles\nAfrica\n82\n\n\nSYR\nSyrian Arab Republic\n—\nEastern Mediterranean\n61\n\n\nTCD\nChad\nRepublic of Chad\nAfrica\n158\n\n\nTGO\nTogo\nTogolese Republic\nAfrica\n141\n\n\nTHA\nThailand\nKingdom of Thailand\nSouth-East Asia\n111\n\n\nTJK\nTajikistan\nRepublic of Tajikistan\nEurope\n59\n\n\nTKM\nTurkmenistan\n—\nEurope\n57\n\n\nTLS\nTimor-Leste\nDemocratic Republic of Timor-Leste\nSouth-East Asia\n78\n\n\nTON\nTonga\nKingdom of Tonga\nWestern Pacific\n118\n\n\nTTO\nTrinidad and Tobago\nRepublic of Trinidad and Tobago\nAmericas\n191\n\n\nTUN\nTunisia\nRepublic of Tunisia\nEastern Mediterranean\n35\n\n\nTUR\nTürkiye\nRepublic of Türkiye\nEurope\n59\n\n\nTUV\nTuvalu\n—\nWestern Pacific\n170\n\n\nTZA\nTanzania, United Republic of\nUnited Republic of Tanzania\nAfrica\n148\n\n\nUGA\nUganda\nRepublic of Uganda\nAfrica\n132\n\n\nUKR\nUkraine\n—\nEurope\n4\n\n\nURY\nUruguay\nEastern Republic of Uruguay\nAmericas\n48\n\n\nUSA\nUnited States\nUnited States of America\nAmericas\n54\n\n\nUZB\nUzbekistan\nRepublic of Uzbekistan\nEurope\n76\n\n\nVCT\nSaint Vincent and the Grenadines\n—\nAmericas\n190\n\n\nVEN\nVenezuela, Bolivarian Republic of\nBolivarian Republic of Venezuela\nAmericas\n110\n\n\nVNM\nViet Nam\nSocialist Republic of Viet Nam\nWestern Pacific\n75\n\n\nVUT\nVanuatu\nRepublic of Vanuatu\nWestern Pacific\n128\n\n\nWSM\nSamoa\nIndependent State of Samoa\nWestern Pacific\n135\n\n\nYEM\nYemen\nRepublic of Yemen\nEastern Mediterranean\n63\n\n\nZAF\nSouth Africa\nRepublic of South Africa\nAfrica\n185\n\n\nZMB\nZambia\nRepublic of Zambia\nAfrica\n145\n\n\nZWE\nZimbabwe\nRepublic of Zimbabwe\nAfrica\n138",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#other-indicators-of-interest",
    "href": "who-indicators.html#other-indicators-of-interest",
    "title": "5  WHO indicators",
    "section": "5.4 Other indicators of interest",
    "text": "5.4 Other indicators of interest\nData available\n\nNCD_BMI_MEAN Mean BMI (kg/m²) (age-standardized estimate)\nNCD_BMI_30A Prevalence of obesity among adults, BMI ≥ 30 (age-standardized estimate) (%)\nNCD_HYP_PREVALENCE_A Prevalence of hypertension among adults aged 30-79 years, age-standardized\nDONE: WHS2_131 Age-standardized NCD mortality rate (per 100 000 population)\n\nData not available\n\nWHS2_161 Age-standardized mortality rate by cause (per 100 000 population) - Cardiovascular\nWHS2_160 Age-standardized mortality rate by cause (per 100 000 population) - Cancer\n\n\nTODO: Add more visualizations here. Should any plots be functions instead?",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#whs2_131-age-standardized-ncd-mortality-rate-per-100-000-population",
    "href": "who-indicators.html#whs2_131-age-standardized-ncd-mortality-rate-per-100-000-population",
    "title": "5  WHO indicators",
    "section": "5.5 WHS2_131 Age-standardized NCD mortality rate (per 100 000 population)",
    "text": "5.5 WHS2_131 Age-standardized NCD mortality rate (per 100 000 population)\n\n\nShow the code\n# Age-standardized death rates, diabetes mellitus, per 100,000\n\nncd_long &lt;- ncd_mortality |&gt;\n  pivot_longer(cols = dim1,\n               #names_to = \"sex\",\n               values_to = \"sex_value\")\n\nncd_wide &lt;- ncd_long |&gt;\n  pivot_wider(#cols = dim1,\n               names_from = sex_value,\n               values_from = numeric_value) |&gt;\n  mutate(rank_val = rank(SEX_BTSX, ties.method = \"max\"),\n         spatial_dim_label = glue(\"{spatial_dim}: {rank_val}\"),\n         spatial_dim_label = fct_reorder(spatial_dim_label, rank_val)) |&gt;\n  mutate(pct_SEX_MLE = SEX_MLE / 1e5,\n         pct_SEX_FMLE = SEX_FMLE / 1e5,\n         pct_SEX_BTSX = SEX_BTSX / 1e5,)\n\n\n\n\n\nShow the code\nncd_mortality |&gt;\n  filter(spatial_dim %in% c(\"FJI\", \"USA\", \"FRA\")) |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = dim1),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = dim1)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(#labels = label_percent(),\n                     expand = expansion(mult = c(0.002, 0))) +\n  expand_limits(y = 0) +\n  facet_wrap(~spatial_dim) +\n  labs(\n    title = \"Fiji, France, USA: non-communicable disease mortality rates per 100,000 people\",\n    x = NULL,\n    # y = \"Age\",\n    color = NULL,\n    fill = NULL,\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\n\n\n\n\n\n\n\nFigure 5.5: Comparing Fiji’s Healthy life expectancy at birth (HALE) to France and USA\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- ncd_mortality |&gt;\n  filter(spatial_dim_type == \"WORLDBANKINCOMEGROUP\" | (spatial_dim_type == \"COUNTRY\" & spatial_dim == \"FJI\"),\n         dim1 == \"SEX_BTSX\") |&gt;\n  mutate(spatial_dim = factor(spatial_dim, levels = c(\"WB_LI\", \"WB_LMI\", \"WB_UMI\", \"WB_HI\", \"FJI\"))) |&gt;\n  mutate(numeric_value_norm = numeric_value / numeric_value[time_dim == 2000],\n         low_norm = low / low[time_dim == 2000],\n         high_norm = high / high[time_dim == 2000],\n         .by = spatial_dim)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = spatial_dim),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = spatial_dim),\n            show.legend = FALSE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(#labels = label_percent(),\n                     expand = expansion(mult = c(0, 0.02))) +\n  expand_limits(y = 0) +\n  labs(\n    x = NULL,\n    y = \"Rate\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low_norm, ymax = high_norm, fill = spatial_dim),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value_norm, color = spatial_dim)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(mult = c(0, 0.02))) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  expand_limits(y = 0) +\n  labs(\n    subtitle = \"Year 2000 = 100%\",\n    x = NULL,\n    y = \"Relative improvement\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\"\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Fiji has been lowering NDC mortality at a rate similar to\",\n                 \"\\nWorld Bank lower and lower-middle income groups\"),\n    subtitle = \"Both sexes\",\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  ) +\n  plot_layout(guides = \"collect\")\n\n\n\n\n\n\n\n\nFigure 5.6: Non-communicable disease mortality rates: Fiji and World Bank income groups\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- ncd_long |&gt;\n  filter(spatial_dim_type == \"COUNTRY\",\n         sex_value == \"SEX_BTSX\",\n         time_dim == 2019)\n\ndta_for_plot_labels &lt;- tribble(\n  ~parent_location,          ~x,    ~y,\n  \"Africa\",                  720,   0.0039,\n  \"Americas\",                400,   0.0042,\n  \"Eastern Mediterranean\",   800,   0.002,\n  \"Europe\",                  300,   0.003,\n  \"South-East Asia\",         750,   0.003,\n  \"Western Pacific\",         900,   0.0012,\n)\n\necdf_fun &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Western Pacific\") |&gt;\n    pull(numeric_value)\n)\n\nfiji_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Western Pacific\",\n           spatial_dim == \"FJI\") |&gt;\n    pull(numeric_value)\n\nfiji_percentile &lt;- ecdf_fun(fiji_value)\n\necdf_fun_americas &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Americas\") |&gt;\n    pull(numeric_value)\n)\n\nusa_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Americas\",\n           spatial_dim == \"USA\") |&gt;\n    pull(numeric_value)\n\nusa_percentile &lt;- ecdf_fun_americas(usa_value)\n  \necdf_fun_europe &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Europe\") |&gt;\n    pull(numeric_value)\n)\n\nfra_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Europe\",\n           spatial_dim == \"FRA\") |&gt;\n    pull(numeric_value)\n\nfra_percentile &lt;- ecdf_fun_europe(fra_value)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_density(aes(x = numeric_value, color = parent_location),\n               linewidth = 0.6, alpha = 0.8,\n               show.legend = FALSE) +\n  geom_text(data = dta_for_plot_labels,\n            aes(x, y, label = parent_location, color = parent_location),\n            hjust = 0, nudge_x = 1, size = 4,\n            show.legend = FALSE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(#labels = label_percent(),\n    expand = expansion(mult = c(0.002, 0))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Density\",\n    x = \"People per 100K\",\n    y = NULL,\n    # caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  stat_ecdf(aes(x = numeric_value, color = parent_location),\n            linewidth = 0.6, alpha = 0.8,\n            pad = FALSE,\n            show.legend = FALSE) +\n  annotate(\"point\", x = fiji_value, y = fiji_percentile) +\n  annotate(\"label\", x = fiji_value + 40, y = fiji_percentile, label = \"Republic of Fiji\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = usa_value, y = usa_percentile) +\n  annotate(\"label\", x = usa_value + 3, y = usa_percentile, label = \"USA\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = fra_value, y = fra_percentile) +\n  annotate(\"label\", x = fra_value + 3, y = fra_percentile, label = \"France\",\n            hjust = 0, size = 4) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(mult = c(0.002, 0))) +\n  # facet_wrap(~parent_location, scales = \"free_y\") +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Cumulative Distribution\",\n    x = \"People per 100K\",\n    y = \"Percent of all countries in region\"\n    \n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Age-standardized NCD mortality, per 100,000 people (2019)\"),\n    subtitle = glue(\"Both sexes, country distribution, by region\"),\n    caption = glue(\"Daniel Moul. Source: WHO GHO\",\n                   \"\\n(not weighted by population)\")\n  )\n\n\n\n\n\n\n\n\nFigure 5.7: NCD mortaility 2019 by region",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#prevalence-of-obesity-among-adults",
    "href": "who-indicators.html#prevalence-of-obesity-among-adults",
    "title": "5  WHO indicators",
    "section": "5.6 Prevalence of obesity among adults",
    "text": "5.6 Prevalence of obesity among adults\nNCD_BMI_30A Prevalence of obesity among adults, BMI ≥ 30 (age-standardized estimate) (%)\n\n\nShow the code\n# Age-standardized death rates, diabetes mellitus, per 100,000\n\nobesity_long &lt;- bmi_obesity |&gt;\n  pivot_longer(cols = dim1,\n               #names_to = \"sex\",\n               values_to = \"sex_value\")\n\nobesity_wide &lt;- obesity_long |&gt;\n  pivot_wider(#cols = dim1,\n               names_from = sex_value,\n               values_from = numeric_value) |&gt;\n  mutate(rank_val = rank(SEX_BTSX, ties.method = \"max\"),\n         spatial_dim_label = glue(\"{spatial_dim}: {rank_val}\"),\n         spatial_dim_label = fct_reorder(spatial_dim_label, rank_val)) |&gt;\n  mutate(pct_SEX_MLE = SEX_MLE / 1e5,\n         pct_SEX_FMLE = SEX_FMLE / 1e5,\n         pct_SEX_BTSX = SEX_BTSX / 1e5,)\n\n\n\n\n\nShow the code\nbmi_obesity |&gt;\n  filter(spatial_dim %in% c(\"FJI\", \"USA\", \"FRA\")) |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = dim1),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = dim1)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_number(suffix = \"%\"),\n                     expand = expansion(mult = c(0.002, 0.02))) +\n  expand_limits(y = 0) +\n  facet_wrap(~spatial_dim) +\n  labs(\n    title = \"Fiji, France, USA: Adult obseity\",\n    x = NULL,\n    y = \"Adult obseity\",\n    color = NULL,\n    fill = NULL,\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\n\n\n\n\n\n\n\nFigure 5.8: Comparing Fiji’s adult obesity to France and USA\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- bmi_obesity |&gt;\n  filter(spatial_dim_type == \"WORLDBANKINCOMEGROUP\" | (spatial_dim_type == \"COUNTRY\" & spatial_dim == \"FJI\"),\n         dim1 == \"SEX_BTSX\") |&gt;\n  mutate(spatial_dim = factor(spatial_dim, levels = c(\"WB_LI\", \"WB_LMI\", \"WB_UMI\", \"WB_HI\", \"FJI\"))) |&gt;\n  mutate(numeric_value_norm = numeric_value / numeric_value[time_dim == 1990],\n         low_norm = low / low[time_dim == 1990],\n         high_norm = high / high[time_dim == 1990],\n         .by = spatial_dim)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = spatial_dim),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = spatial_dim),\n            show.legend = FALSE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(#labels = label_percent(),\n                     expand = expansion(mult = c(0, 0.02))) +\n  expand_limits(y = 0) +\n  labs(\n    x = NULL,\n    y = \"Rate\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low_norm, ymax = high_norm, fill = spatial_dim),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value_norm, color = spatial_dim)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(mult = c(0, 0.02))) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  expand_limits(y = 0) +\n  labs(\n    subtitle = \"Year 1990 = 100%\",\n    x = NULL,\n    y = \"Relative change\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\"\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Adult obesity in Fiji has grown more slowly than any World Bank income groups\",\n                 \"\\nalbeit from a higher starting percentage\"),\n    subtitle = \"Both sexes\",\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  ) +\n  plot_layout(guides = \"collect\")\n\n\n\n\n\n\n\n\nFigure 5.9: Adult obesity: Fiji and World Bank income groups\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- obesity_long |&gt;\n  filter(spatial_dim_type == \"COUNTRY\",\n         sex_value == \"SEX_BTSX\",\n         time_dim == 2022)\n\ndta_for_plot_labels &lt;- tribble(\n  ~parent_location,          ~x,     ~y,\n  \"Africa\",                  15,    0.05,\n  \"Americas\",                37,    0.042,\n  \"Eastern Mediterranean\",   44,    0.028,\n  \"Europe\",                  20.5,  0.072,\n  \"South-East Asia\",         12,    0.078,\n  \"Western Pacific\",         53,    0.014,\n)\n\necdf_fun &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Western Pacific\") |&gt;\n    pull(numeric_value)\n)\n\nfiji_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Western Pacific\",\n           spatial_dim == \"FJI\") |&gt;\n    pull(numeric_value)\n\nfiji_percentile &lt;- ecdf_fun(fiji_value)\n\necdf_fun_americas &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Americas\") |&gt;\n    pull(numeric_value)\n)\n\nusa_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Americas\",\n           spatial_dim == \"USA\") |&gt;\n    pull(numeric_value)\n\nusa_percentile &lt;- ecdf_fun_americas(usa_value)\n\necdf_fun_europe &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Europe\") |&gt;\n    pull(numeric_value)\n)\n\nfra_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Europe\",\n           spatial_dim == \"FRA\") |&gt;\n    pull(numeric_value)\n\nfra_percentile &lt;- ecdf_fun_europe(fra_value)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_density(aes(x = numeric_value, color = parent_location),\n               linewidth = 0.6, alpha = 0.8,\n               show.legend = FALSE) +\n  geom_text(data = dta_for_plot_labels,\n            aes(x, y, label = parent_location, color = parent_location),\n            hjust = 0, nudge_x = 1, size = 4,\n            show.legend = FALSE) +\n  scale_x_continuous(labels = label_number(suffix = \"%\"),\n                     expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_number(suffix = \"%\"),\n    expand = expansion(mult = c(0.002, 0))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Density\",\n    x = \"Percent of adult population\",\n    y = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  stat_ecdf(aes(x = numeric_value, color = parent_location),\n            linewidth = 0.6, alpha = 0.8,\n            pad = FALSE,\n            show.legend = FALSE) +\n  annotate(\"point\", x = fiji_value, y = fiji_percentile) +\n  annotate(\"label\", x = fiji_value + 3, y = fiji_percentile, label = \"Republic of Fiji\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = usa_value, y = usa_percentile) +\n  annotate(\"label\", x = usa_value + 3, y = usa_percentile, label = \"USA\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = fra_value, y = fra_percentile) +\n  annotate(\"label\", x = fra_value + 3, y = fra_percentile, label = \"France\",\n            hjust = 0, size = 4) +\n  scale_x_continuous(labels = label_number(suffix = \"%\"),\n                     expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(mult = c(0.002, 0))) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Cumulative Distribution\",\n    x = \"Percent of adult population\",\n    y = \"Percent of all countries in region\"\n    \n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Adult obesity (2019)\"),\n    subtitle = glue(\"Both sexes, country distribution, by region\"),\n    caption = glue(\"Daniel Moul. Source: WHO GHO\",\n                   \"\\n(not weighted by population)\")\n  )\n\n\n\n\n\n\n\n\nFigure 5.10: Adult obesity 2022 by region",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#mean-bmi-kgm²",
    "href": "who-indicators.html#mean-bmi-kgm²",
    "title": "5  WHO indicators",
    "section": "5.7 Mean BMI (kg/m²)",
    "text": "5.7 Mean BMI (kg/m²)\nNCD_BMI_MEAN Mean BMI (kg/m²) (age-standardized estimate)\n\n\nShow the code\n# NCD_BMI_MEAN Mean BMI (kg/m²) (age-standardized estimate)\n\nbmi_mean_long &lt;- bmi_mean |&gt;\n  pivot_longer(cols = dim1,\n               #names_to = \"sex\",\n               values_to = \"sex_value\")\n\nbmi_mean_wide &lt;- bmi_mean_long |&gt;\n  pivot_wider(#cols = dim1,\n               names_from = sex_value,\n               values_from = numeric_value) |&gt;\n  mutate(rank_val = rank(SEX_BTSX, ties.method = \"max\"),\n         spatial_dim_label = glue(\"{spatial_dim}: {rank_val}\"),\n         spatial_dim_label = fct_reorder(spatial_dim_label, rank_val)) |&gt;\n  mutate(pct_SEX_MLE = SEX_MLE / 1e5,\n         pct_SEX_FMLE = SEX_FMLE / 1e5,\n         pct_SEX_BTSX = SEX_BTSX / 1e5,)\n\n\n\n\n\nShow the code\nbmi_obesity |&gt;\n  filter(spatial_dim %in% c(\"FJI\", \"USA\", \"FRA\")) |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = dim1),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = dim1)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(#labels = label_number(suffix = \"%\"),\n                     expand = expansion(mult = c(0.002, 0.02))) +\n  expand_limits(y = 0) +\n  facet_wrap(~spatial_dim) +\n  labs(\n    title = \"Fiji, France, USA: Age adjusted mean BMI\",\n    x = NULL,\n    y = \"Mean BMI\",\n    color = NULL,\n    fill = NULL,\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  )\n\n\n\n\n\n\n\n\nFigure 5.11: Comparing Fiji’s mean BMI to France and USA\n\n\n\n\n\nTODO: Does Figure 5.11 make sense compared to adult obesity (Figure 5.10)\n\n\n\nShow the code\ndta_for_plot &lt;- bmi_mean |&gt;\n  filter(spatial_dim_type == \"WORLDBANKINCOMEGROUP\" | (spatial_dim_type == \"COUNTRY\" & spatial_dim == \"FJI\"),\n         dim1 == \"SEX_BTSX\") |&gt;\n  mutate(spatial_dim = factor(spatial_dim, levels = c(\"WB_LI\", \"WB_LMI\", \"WB_UMI\", \"WB_HI\", \"FJI\"))) |&gt;\n  mutate(numeric_value_norm = numeric_value / numeric_value[time_dim == 1975],\n         low_norm = low / low[time_dim == 1975],\n         high_norm = high / high[time_dim == 1975],\n         .by = spatial_dim)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low, ymax = high, fill = spatial_dim),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value, color = spatial_dim),\n            show.legend = FALSE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(#labels = label_percent(),\n                     expand = expansion(mult = c(0, 0.02))) +\n  expand_limits(y = 0) +\n  labs(\n    x = NULL,\n    y = \"Rate\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = time_dim, ymin = low_norm, ymax = high_norm, fill = spatial_dim),\n  #             alpha = 0.3) +\n  geom_line(aes(x = time_dim, y = numeric_value_norm, color = spatial_dim)) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(mult = c(0, 0.02))) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  expand_limits(y = 0) +\n  labs(\n    subtitle = \"Year 1975 = 100%\",\n    x = NULL,\n    y = \"Relative improvement\",\n    color = \"Fiji and WB\\nincome group\",\n    fill = \"Fiji and WB\\nincome group\"\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Mean BMI in Fiji has grown even faster\",\n                 \" than World Bank lower and lower middle income groups\"),\n    subtitle = \"Both sexes\",\n    caption = \"Daniel Moul. Source: WHO GHO\"\n  ) +\n  plot_layout(guides = \"collect\")\n\n\n\n\n\n\n\n\nFigure 5.12: Mean MBI: Fiji and World Bank income groups\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- obesity_long |&gt;\n  filter(spatial_dim_type == \"COUNTRY\",\n         sex_value == \"SEX_BTSX\",\n         time_dim == 2016)\n\ndta_for_plot_labels &lt;- tribble(\n  ~parent_location,          ~x,     ~y,\n  \"Africa\",                  12,    0.065,\n  \"Americas\",                33,    0.055,\n  \"Eastern Mediterranean\",   42,    0.028,\n  \"Europe\",                  18.5,  0.085,\n  \"South-East Asia\",         10,    0.1,\n  \"Western Pacific\",         50,    0.016,\n)\n\necdf_fun &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Western Pacific\") |&gt;\n    pull(numeric_value)\n)\n\nfiji_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Western Pacific\",\n           spatial_dim == \"FJI\") |&gt;\n    pull(numeric_value)\n\nfiji_percentile &lt;- ecdf_fun(fiji_value)\n\necdf_fun_americas &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Americas\") |&gt;\n    pull(numeric_value)\n)\n\nusa_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Americas\",\n           spatial_dim == \"USA\") |&gt;\n    pull(numeric_value)\n\nusa_percentile &lt;- ecdf_fun_americas(usa_value)\n\necdf_fun_europe &lt;- ecdf(\n  dta_for_plot |&gt;\n    filter(parent_location == \"Europe\") |&gt;\n    pull(numeric_value)\n)\n\nfra_value &lt;- dta_for_plot |&gt;\n    filter(parent_location == \"Europe\",\n           spatial_dim == \"FRA\") |&gt;\n    pull(numeric_value)\n\nfra_percentile &lt;- ecdf_fun_europe(fra_value)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_density(aes(x = numeric_value, color = parent_location),\n               linewidth = 0.6, alpha = 0.8,\n               show.legend = FALSE) +\n  geom_text(data = dta_for_plot_labels,\n            aes(x, y, label = parent_location, color = parent_location),\n            hjust = 0, nudge_x = 1, size = 4,\n            show.legend = FALSE) +\n  scale_x_continuous(labels = label_number(suffix = \"%\"),\n                     expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_number(suffix = \"%\"),\n    expand = expansion(mult = c(0.002, 0))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Density\",\n    x = \"Percent of population\",\n    y = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  stat_ecdf(aes(x = numeric_value, color = parent_location),\n            linewidth = 0.6, alpha = 0.8,\n            pad = FALSE,\n            show.legend = FALSE) +\n  annotate(\"point\", x = fiji_value, y = fiji_percentile) +\n  annotate(\"label\", x = fiji_value + 3, y = fiji_percentile, label = \"Republic of Fiji\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = usa_value, y = usa_percentile) +\n  annotate(\"label\", x = usa_value + 3, y = usa_percentile, label = \"USA\",\n            hjust = 0, size = 4) +\n  annotate(\"point\", x = fra_value, y = fra_percentile) +\n  annotate(\"label\", x = fra_value + 3, y = fra_percentile, label = \"France\",\n            hjust = 0, size = 4) +\n  scale_x_continuous(labels = label_number(suffix = \"%\"),\n                     expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(labels = label_percent(),\n                     expand = expansion(mult = c(0.002, 0))) +\n  expand_limits(y = 0) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  theme(panel.grid.major.x = element_line(linewidth = 0.03)) +\n  labs(\n    subtitle = \"Cumulative Distribution\",\n    x = \"Percent of population\",\n    y = \"Percent of all countries in region\"\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"Mean BMI (2016)\"),\n    subtitle = glue(\"Both sexes, country distribution, by region\"),\n    caption = glue(\"Daniel Moul. Source: WHO GHO\",\n                   \"\\n(not weighted by population)\")\n  )\n\n\n\n\n\n\n\n\nFigure 5.13: Mean BMI 2016 by region\n\n\n\n\n\nTODO: Does Figure 5.13 make sense compared to adult obesity (Figure 5.10)",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "who-indicators.html#footnotes",
    "href": "who-indicators.html#footnotes",
    "title": "5  WHO indicators",
    "section": "",
    "text": "https://data.who.int/indicators/i/48D9B0C/C64284D ↩︎\nibid.↩︎\nWorld Bank Country and Lending Groups https://datahelpdesk.worldbank.org/knowledgebase/articles/906519-world-bank-country-and-lending-groups ↩︎",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>WHO indicators</span>"
    ]
  },
  {
    "objectID": "overseas-arrivals.html",
    "href": "overseas-arrivals.html",
    "title": "6  Overseas arrivals, tourism revenue, and hotel nights",
    "section": "",
    "text": "6.1 Overseas visitors\nShow the code\nsource(here::here(\"scripts/load-libraries.R\"))\n\ntheme_set(theme_light() +\n            theme(panel.grid.major = element_blank(),\n                  panel.grid.minor = element_blank()))\n\noptions(scipen = 5)\n\nmy_caption &lt;- \"Plot: Daniel Moul; Data: South Pacific Community\"\nmy_caption_fbos &lt;- \"Plot: Daniel Moul; Data: Fiji Bureau of Statistics via Reserve Bank of Fiji\"\nShow the code\nvisitors_all_cat &lt;- read_csv(here(\"./data/raw/overseas-visitor-arrivals/SPC-DF_OVERSEAS_VISITORS-2.0-all.csv\"),\n               show_col_types = FALSE) |&gt;\n  clean_names() |&gt;\n  remove_empty(which = \"cols\")\n\nvisitors_total &lt;- visitors_all_cat |&gt;\n  filter(overseas_visitors_type_2 == \"Total\") |&gt;\n  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |&gt;\n  mutate(max_annual = max(obs_value),\n         pct_of_max = obs_value / max_annual,\n         min_year = min(time_period),\n         max_year = max(time_period),\n         pct_of_first_year = obs_value / obs_value[time_period == min_year],\n         .by = pacific_island_countries_and_territories)\nShow the code\nfname &lt;- here(\"./data/raw/rbf/5.4-Visitors-Arrivals-Number-by-Country-of-Residence.xlsx\")\nvisitors_by_country_raw &lt;- readxl::read_xlsx(fname,\n                                             sheet = \"Table 44\",\n                                             range = \"A2:K43\") |&gt;\n  clean_names() |&gt;\n  remove_empty(which = \"cols\") |&gt;\n  rename(nz = new_zealand,\n         usa = \"united_states_of_america\",\n         uk = \"united_kingdom\",\n         europe = \"continental_europe\") |&gt;\n  select(-total)\n\n# mutate(m = mean(c_across(x:z)))\n\nvisitors_by_country_long &lt;- visitors_by_country_raw |&gt;\n  rowwise() |&gt;\n  mutate(total = sum(c_across(australia:others))) |&gt;\n  pivot_longer(cols = australia:total,\n               names_to = \"country\",\n               values_to = \"visitors\") |&gt;\n  mutate(country = fct_reorder(country, -visitors, sum)) |&gt;\n  mutate(pct_of_yearly = visitors / sum(visitors),\n         .by = period) |&gt;\n  mutate(visitors_normalized = visitors / visitors[period == 1983],\n         yty_growth = visitors / lag(visitors, default = NA) - 1,\n         .by = country)\n\n# https://en.wikipedia.org/wiki/Fiji_coup\n# Also including the 2009 constitutional crisis\n# https://en.wikipedia.org/wiki/2009_Fijian_constitutional_crisis\ncoup_years &lt;- tibble(\n  period = c(1987, 2000, 2006, 2009)\n)\nMost PICTs experienced a positive trend in annual visitors until the COVID-19 pandemic.\nShow the code\nvisitors_total |&gt;\n  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |&gt;\n  ggplot() +\n  geom_line(aes(time_period, obs_value, \n                color = if_else(place == \"Fiji\",\n                                     \"purple\", \n                                     \"black\"))) +\n  \n  scale_color_identity() +\n  facet_wrap(~place, scales = \"free_y\") +\n  labs(\n    title = \"Annual overseas visitors\",\n    subtitle = \"2005-2022; Y axis varies\",\n    x = NULL,\n    y = NULL,\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 6.1: Annual overseas visitors\nThere are many ways one could compare the overseas visitors numbers among PICTs. I offer four below.\nShow the code\np0 &lt;- visitors_total |&gt;\n  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |&gt;\n  ggplot() +\n  geom_line(aes(time_period, obs_value + 1, \n                color = if_else(place == \"Fiji\",\n                                     \"purple\", \n                                     \"black\"),\n                linewidth = if_else(place == \"Fiji\",\n                                     1, \n                                     0),\n                group = place),\n            alpha = 0.5\n            ) +\n  geom_smooth(aes(time_period, obs_value + 1),\n              method = \"loess\", formula = 'y ~ x',\n              span = 0.2, se = FALSE) +\n  scale_color_identity() +\n  scale_linewidth_continuous(range = c(0.25, 1.0)) +\n  scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),\n                     labels = label_number(big.mark = \",\")) +\n  guides(linewidth = \"none\") +\n  labs(\n    subtitle = \"A: Count\",\n    x = NULL,\n    y = NULL\n  )\n\np1 &lt;- visitors_total |&gt;\n  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |&gt;\n  ggplot() +\n  geom_line(aes(time_period, obs_value + 1, \n                color = if_else(place == \"Fiji\",\n                                     \"purple\", \n                                     \"black\"),\n                linewidth = if_else(place == \"Fiji\",\n                                     1, \n                                     0),\n                group = place),\n            alpha = 0.5\n            ) +\n  geom_smooth(aes(time_period, obs_value + 1),\n              method = \"loess\", formula = 'y ~ x',\n              span = 0.2, se = FALSE) +\n  scale_color_identity() +\n  scale_linewidth_continuous(range = c(0.25, 1.0)) +\n  scale_y_log10(expand = expansion(mult = c(0.01, 0.05)),\n                labels = label_number(big.mark = \",\")) +\n  guides(linewidth = \"none\") +\n  labs(\n    subtitle = \"B: Count (log10 scale)\",\n    x = NULL,\n    y = NULL\n  )\n\np2 &lt;- visitors_total |&gt;\n  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |&gt;\n  ggplot() +\n  geom_line(aes(time_period, pct_of_first_year, \n                color = if_else(place == \"Fiji\",\n                                     \"purple\", \n                                     \"black\"),\n                linewidth = if_else(place == \"Fiji\",\n                                     1, \n                                     0),\n                group = place),\n            alpha = 0.5\n            ) +\n  geom_smooth(aes(time_period, pct_of_first_year),\n              method = \"loess\", formula = 'y ~ x',\n              span = 0.2, se = FALSE) +\n  scale_color_identity() +\n  scale_linewidth_continuous(range = c(0.25, 1.0)) +\n  scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),\n                     labels = label_number(big.mark = \",\")) +\n  guides(linewidth = \"none\") +\n  labs(\n    subtitle = \"C: Trends normalized (1.0 = value for each place at first year in data set)\",\n    x = NULL,\n    y = NULL\n  )\n\np3 &lt;- visitors_total |&gt;\n  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |&gt;\n  ggplot() +\n  geom_line(aes(time_period, pct_of_max, \n                color = if_else(place == \"Fiji\",\n                                     \"purple\", \n                                     \"black\"),\n                linewidth = if_else(place == \"Fiji\",\n                                     1, \n                                     0),\n                group = place),\n            alpha = 0.5\n            ) +\n  geom_smooth(aes(time_period, pct_of_max),\n              method = \"loess\", formula = 'y ~ x',\n              span = 0.2, se = FALSE) +\n  scale_color_identity() +\n  scale_linewidth_continuous(range = c(0.25, 1.0)) +\n  scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),\n                     labels = label_number(big.mark = \",\")) +\n  guides(linewidth = \"none\") +\n  labs(\n    subtitle = \"D: Trends normalized (1.0 = max for each place)\",\n    x = NULL,\n    y = NULL\n  )\n\np0 + p1 + p2 + p3 +\n  plot_annotation(\n    title = \"Annual overseas visitor trends: four views\",\n    subtitle = \"Fiji = purple. 2000-2022\",\n    caption = my_caption\n  )\n\n\n\n\n\n\n\n\nFigure 6.2: Annual overseas visitor trends: four views",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Overseas arrivals, tourism revenue, and hotel nights</span>"
    ]
  },
  {
    "objectID": "overseas-arrivals.html#visitors-by-country",
    "href": "overseas-arrivals.html#visitors-by-country",
    "title": "6  Overseas arrivals, tourism revenue, and hotel nights",
    "section": "6.2 Visitors by country",
    "text": "6.2 Visitors by country\n\n\nShow the code\ndta_for_plot &lt;- visitors_by_country_long |&gt;\n  filter(country != \"total\")\n\nyear_min &lt;- min(dta_for_plot$period)\nyear_max &lt;- max(dta_for_plot$period)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_line(aes(x = period, y = visitors, color = country),\n            show.legend = FALSE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(expand = expansion(mult = c(0.002, 0.02)),\n                     labels = label_number(scale_cut = cut_short_scale())) +\n  labs(\n    title = glue(\"Count\"),\n    x = NULL,\n    y = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_line(aes(x = period, y = pct_of_yearly, color = country),\n            show.legend = FALSE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(expand = expansion(mult = c(0.002, 0.02)),\n                     labels = label_percent()) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  labs(\n    title = glue(\"Percent of yearly\"),\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np3 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_line(aes(x = period, y = visitors_normalized, color = country),\n            show.legend = TRUE) +\n  scale_x_continuous(expand = expansion(mult = c(0, 0))) +\n  scale_y_continuous(expand = expansion(mult = c(0.002, 0.02)),\n                     labels = label_percent()) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  labs(\n    title = glue(\"Relative growth (100% = 1983)\"),\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np1 / p2 / p3 +\n  plot_annotation(\n    title = glue(\"Yearly visitors to Fiji by country {year_min} to {year_max}\"),\n    # subtitle = \"Vertical lines are years with coups or constitutional crises\",\n    caption = my_caption_fbos\n  ) +\n  plot_layout(guides = \"collect\")\n\n\n\n\n\n\n\n\nFigure 6.3: Annual overseas visitor by country\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- visitors_by_country_long |&gt;\n  filter(country != \"total\",\n         period &lt; 2020)\n\nyear_min &lt;- min(dta_for_plot$period)\nyear_max &lt;- max(dta_for_plot$period)\n\ndta_for_plot |&gt;\n  ggplot(aes(x = period, y = yty_growth, color = country)) +\n  geom_vline(xintercept = coup_years$period, lty = 2, linewidth = 0.25, alpha = 0.4) +\n  geom_hline(yintercept = 0, linewidth = 0.25, alpha = 0.4) +\n  geom_point(size = 1.0, alpha = 0.4,\n             na.rm = TRUE) +\n  geom_smooth(method = 'loess', formula = 'y ~ x', se = TRUE,\n              linewidth = 0.75,\n              fill = \"grey\", alpha = 0.25,\n              na.rm = TRUE) +\n  scale_x_continuous(expand = expansion(mult = c(0.01, 0.01))) +\n  scale_y_continuous(expand = expansion(mult = c(0.002, 0.02)),\n                     labels = label_percent()) +\n  guides(color = \"none\") +\n  coord_cartesian(ylim = c(NA, 0.55)) +\n  facet_wrap(~country) +\n  labs(\n    title = glue(\"Year-to-year growth in visitors to Fiji by country {year_min} to {year_max}\"),\n    subtitle = glue(\"Vertical lines are years with political instability*\",\n                    \"\\nNot surprising that those years saw significant drops in visitors\", \n                    \" compared to the year prior\"),\n    x = NULL,\n    y = NULL,\n    color = NULL,\n    caption = glue(my_caption_fbos,\n                   \"\\n*Coup or constitutional crisis\",\n                   \"\\nNot showing one Japanese outlier &gt; 50%\")\n  )\n\n\n\n\n\n\n\n\nFigure 6.4: Year-to-year growth rate in overseas visitors by country\n\n\n\n\n\n\n\n\nShow the code\nvisitors_for_table &lt;- visitors_by_country_long |&gt;\n  filter(period %in% c(1983, 1993, 2003, 2013, 2023)) |&gt;\n  select(-pct_of_yearly, -yty_growth) |&gt;\n  pivot_wider(names_from = period,\n              values_from = c(visitors, visitors_normalized))\n\nvisitors_for_table |&gt;\n  arrange(-visitors_2023) |&gt;\n  gt() |&gt;\n  tab_header(md(\"**Visitors to Fiji 1983 - 2023 including counts normalized to 1983**\")) |&gt;\n  tab_options(table.font.size = 10) |&gt;\n  fmt_number(columns = visitors_1983:visitors_2023,\n             decimals = 0) |&gt;\n  fmt_percent(columns = visitors_normalized_1983:visitors_normalized_2023,\n             decimals = 0)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nVisitors to Fiji 1983 - 2023 including counts normalized to 1983\n\n\ncountry\nvisitors_1983\nvisitors_1993\nvisitors_2003\nvisitors_2013\nvisitors_2023\nvisitors_normalized_1983\nvisitors_normalized_1993\nvisitors_normalized_2003\nvisitors_normalized_2013\nvisitors_normalized_2023\n\n\n\n\ntotal\n191,616\n287,462\n430,800\n657,707\n929,740\n100%\n150%\n225%\n343%\n485%\n\n\naustralia\n85,027\n77,609\n141,873\n340,151\n434,533\n100%\n91%\n167%\n400%\n511%\n\n\nnz\n24,048\n40,778\n75,016\n108,239\n220,963\n100%\n170%\n312%\n450%\n919%\n\n\nusa\n25,636\n42,557\n58,323\n55,385\n99,518\n100%\n166%\n228%\n216%\n388%\n\n\nothers\n4,661\n8,864\n21,326\n48,002\n54,303\n100%\n190%\n458%\n1,030%\n1,165%\n\n\npacific_islands\n10,588\n16,985\n28,167\n39,450\n54,221\n100%\n160%\n266%\n373%\n512%\n\n\neurope\n8,330\n29,786\n21,847\n28,905\n25,921\n100%\n358%\n262%\n347%\n311%\n\n\ncanada\n13,037\n12,447\n10,990\n13,052\n21,853\n100%\n95%\n84%\n100%\n168%\n\n\nuk\n5,888\n20,233\n49,794\n17,209\n10,680\n100%\n344%\n846%\n292%\n181%\n\n\njapan\n14,401\n38,203\n23,464\n7,314\n7,748\n100%\n265%\n163%\n51%\n54%\n\n\n\n\n\n\n\n\n\n\nShow the code\nvisitors_for_table &lt;- visitors_by_country_long |&gt;\n  filter(period %in% c(1983, 1993, 2003, 2013, 2023)) |&gt;\n  select(-pct_of_yearly, -visitors_normalized, -yty_growth) |&gt;\n  arrange(period) |&gt;\n  mutate(ten_yr_growth = visitors / lag(visitors, default = NA) - 1,\n         .by = country) |&gt;\n  pivot_wider(names_from = period,\n              values_from = c(visitors, ten_yr_growth)) \n\nvisitors_for_table |&gt;\n  arrange(-visitors_2023) |&gt;\n  select(-ten_yr_growth_1983) |&gt;\n  gt() |&gt;\n  tab_header(md(\"**Visitors to Fiji 1983 - 2023 including 10-year growth rates**\")) |&gt;\n  tab_options(table.font.size = 10) |&gt;\n  fmt_number(columns = visitors_1983:visitors_2023,\n             decimals = 0) |&gt;\n  fmt_percent(columns = ten_yr_growth_1993:ten_yr_growth_2023,\n             decimals = 0)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nVisitors to Fiji 1983 - 2023 including 10-year growth rates\n\n\ncountry\nvisitors_1983\nvisitors_1993\nvisitors_2003\nvisitors_2013\nvisitors_2023\nten_yr_growth_1993\nten_yr_growth_2003\nten_yr_growth_2013\nten_yr_growth_2023\n\n\n\n\ntotal\n191,616\n287,462\n430,800\n657,707\n929,740\n50%\n50%\n53%\n41%\n\n\naustralia\n85,027\n77,609\n141,873\n340,151\n434,533\n−9%\n83%\n140%\n28%\n\n\nnz\n24,048\n40,778\n75,016\n108,239\n220,963\n70%\n84%\n44%\n104%\n\n\nusa\n25,636\n42,557\n58,323\n55,385\n99,518\n66%\n37%\n−5%\n80%\n\n\nothers\n4,661\n8,864\n21,326\n48,002\n54,303\n90%\n141%\n125%\n13%\n\n\npacific_islands\n10,588\n16,985\n28,167\n39,450\n54,221\n60%\n66%\n40%\n37%\n\n\neurope\n8,330\n29,786\n21,847\n28,905\n25,921\n258%\n−27%\n32%\n−10%\n\n\ncanada\n13,037\n12,447\n10,990\n13,052\n21,853\n−5%\n−12%\n19%\n67%\n\n\nuk\n5,888\n20,233\n49,794\n17,209\n10,680\n244%\n146%\n−65%\n−38%\n\n\njapan\n14,401\n38,203\n23,464\n7,314\n7,748\n165%\n−39%\n−69%\n6%",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Overseas arrivals, tourism revenue, and hotel nights</span>"
    ]
  },
  {
    "objectID": "overseas-arrivals.html#tourism-revenue",
    "href": "overseas-arrivals.html#tourism-revenue",
    "title": "6  Overseas arrivals, tourism revenue, and hotel nights",
    "section": "6.3 Tourism revenue",
    "text": "6.3 Tourism revenue\nhttps://www.rbf.gov.fj/wp-content/uploads/2024/08/5.5-Hotel-Statistics.xlsx\n\n\nShow the code\nhotel &lt;- read_xlsx(here(\"data/raw/rbf/5.5-Hotel-Statistics.xlsx\"),\n                   sheet = \"Table 5.5\",\n                   range = \"A2:J38\") |&gt;\n  clean_names() |&gt;\n  remove_empty(which = c(\"rows\", \"cols\")) |&gt;\n  filter(row_number() &gt; 2) |&gt;\n  rename(\n    yr = period,\n    room_nights_available = room_nights,\n    room_nights_sold = x3,\n    room_nights_pct_occupied = x4,\n    guest_nights_overseas = guest_nights,\n    guest_nights_local = x6,\n    guest_nights_total = x7,\n    pct_turnover_to_earnings = hotel_turnover_to_gross_tourism_earnings\n  ) |&gt;\n  mutate(yr = parse_number(yr),\n         across(everything(), as.numeric)) |&gt;\n  # fix units\n  mutate(room_nights_available = 1000 * room_nights_available,\n         room_nights_sold = 1000 * room_nights_sold,\n         guest_nights_overseas = 1000 * guest_nights_overseas,\n         guest_nights_local = 1000 * guest_nights_local,\n         guest_nights_total = 1000 * guest_nights_total,\n         hotel_turnover = 1e6 * hotel_turnover,\n         gross_tourism_earnings = 1e6 * gross_tourism_earnings\n         )\n\nhotel_year_min &lt;- min(hotel$yr)\nhotel_year_max &lt;- max(hotel$yr)\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- hotel |&gt;\n  select(yr, hotel_turnover, gross_tourism_earnings, pct_turnover_to_earnings) |&gt;\n  # mutate(pct_turnover = round(pct_turnover_to_earnings) / 100,\n  #        pct_turnover_y = hotel_turnover) |&gt;\n  pivot_longer(cols = c(hotel_turnover, gross_tourism_earnings),\n               names_to = \"metric\",\n               values_to = \"value\") \n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_area(aes(x = yr, y = value, fill = metric), \n            alpha = 0.25,\n              na.rm = TRUE) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02)),\n                     labels = label_number(scale_cut = cut_short_scale())) +\n  scale_fill_viridis_d(end = 0.9, direction = -1) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3)),\n         fill = guide_legend(position = \"inside\")) +\n  expand_limits(y = 0) +\n  theme(legend.position.inside = c(0.3, 0.8)) +\n  labs(\n    subtitle = glue(\"Revenue\"),\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_hline(yintercept = 1, lty = 2, linewidth = 0.15, alpha = 0.5) +\n  geom_line(aes(x = yr, y = pct_turnover_to_earnings),\n            linewidth = 0.5) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02)),\n                     # labels = label_percent(scale = 1)\n                     labels = label_number(suffix = \"%\")\n                     ) +\n  # guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  expand_limits(y = 0) +\n  coord_cartesian(ylim = c(NA, 125)) +\n  labs(\n    subtitle = glue(\"Hotel turnover as a percent of\\ngross tourism earnings\"),\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"It would be hard to overstate the impact of COVID-19\",\n                 \"\\non the tourism sector in Fiji. The borders were closed\",\n                 \"\\nstarting in 2020 Q1 and ending in 2022 Q1.\"),\n    subtitle = glue(\"{hotel_year_min} to {hotel_year_max}.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 6.5: Tourism earnings\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- hotel |&gt;\n  mutate(room_occupancy = guest_nights_total / room_nights_sold) |&gt;\n  select(yr, starts_with(\"room\")) |&gt;\n  mutate(\n    room_nights_unsold = room_nights_available - room_nights_sold,\n    pct_occupied = room_nights_pct_occupied / 100,\n  ) |&gt;\n  pivot_longer(\n    cols = c(room_nights_unsold, room_nights_sold),\n    names_to = \"metric\",\n    values_to = \"value\"\n  )\n\nrooms_sold_unsold &lt;- tribble(\n  ~x,   ~y,       ~label,\n  2010, 2500000, \"Rooms unsold\",\n  2010, 800000,  \"Rooms occupied\"\n)\n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  # geom_ribbon(aes(x = yr, ymin = room_nights_sold, ymax = room_nights_available),\n  #             fill = \"firebrick\", alpha = 0.15,\n  #             na.rm = TRUE) +\n  geom_area(aes(x = yr, y = value, fill = metric),\n            alpha = 0.25,\n            na.rm = TRUE,\n            show.legend = FALSE) +\n  geom_line(aes(x = yr, y = room_nights_available),\n              color = \"firebrick\", alpha = 0.8, linewidth = 0.15,\n              na.rm = TRUE) +\n  # geom_line(aes(x = yr, y = room_nights_sold),\n  #             color = \"firebrick\", alpha = 0.8, linewidth = 0.15,\n  #             na.rm = TRUE) +\n  geom_text(data = rooms_sold_unsold,\n            aes(x = x, y = y, label = label),\n            size = 3, hjust = 0) +\n  annotate(\"text\", x = 1998, y = 3.2e6, label = \"Total rooms\\navailable\",\n           color = \"firebrick\", alpha = 0.8, \n           size = 3, hjust = 0\n  ) +\n  annotate('curve',\n    x = 2001, y = 3.0e6,\n    xend = 2005, yend = 2.9e6,\n    linewidth = 0.5, curvature = 0.25,\n    arrow = arrow(length = unit(0.25, 'cm'),\n                  # color = \"firebrick\", alpha = 0.8)\n    )\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02)),\n                     labels = label_number(scale_cut = cut_short_scale())) +\n  scale_fill_viridis_d(end = 0.9, direction = -1) +\n  guides(#color = guide_legend(override.aes = list(linewidth = 3)),\n         fill = guide_legend(position = \"inside\")) +\n  expand_limits(y = 0) +\n  theme(legend.position.inside = c(0.3, 0.8)) +\n  labs(\n    subtitle = glue(\"Count of room nights\"),\n    x = NULL,\n    y = NULL,\n    caption = my_caption_fbos,\n    color = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_line(aes(x = yr, y = pct_occupied),\n            linewidth = 0.5) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02)),\n                     labels = label_percent()) +\n  # guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  expand_limits(y = 0) +\n  labs(\n    subtitle = glue(\"Percent of room nights occupied\"),\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np3 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_line(aes(x = yr, y = room_occupancy),\n            linewidth = 0.5) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  # guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  expand_limits(y = 0) +\n  labs(\n    subtitle = glue(\"Guests per room\"),\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np1 + (p2 / p3) +\n  plot_annotation(\n    title = glue(\"Room nights in Fiji and guests per room\"),\n    subtitle = glue(\"{hotel_year_min} to {hotel_year_max}.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 6.6: Hotel rooms\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- hotel |&gt;\n  select(yr, guest_nights_local, guest_nights_overseas) |&gt;\n  mutate(pct_local = round(guest_nights_local / (guest_nights_local + \n                                                         guest_nights_overseas), digits = 2),\n         pct_local_y = guest_nights_local + guest_nights_overseas) |&gt;\n  pivot_longer(cols = starts_with(\"guest\"),\n               names_to = \"metric\",\n               values_to = \"value\") \n\np1 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_area(aes(x = yr, y = value, fill = metric), \n            alpha = 0.25,\n              na.rm = TRUE) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02)),\n                     labels = label_number(scale_cut = cut_short_scale())) +\n  scale_fill_viridis_d(end = 0.9, direction = -1) +\n  guides(fill = guide_legend(position = \"inside\")) +\n  expand_limits(y = 0) +\n  theme(legend.position.inside = c(0.3, 0.8)) +\n  labs(\n    subtitle = \"Count of guest nights\",\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot() +\n  geom_line(aes(x = yr, y = pct_local),\n            linewidth = 0.5) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02)),\n                     labels = label_percent()) +\n  # guides(fill = guide_legend(position = \"inside\")) +\n  expand_limits(y = 0) +\n  coord_cartesian(ylim = c(NA, 0.3)) +\n  labs(\n    subtitle = \"Percent of guest nights by locals\",\n    x = NULL,\n    y = NULL,\n    color = NULL\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = glue(\"An increasing percentage of guest nights are booked by locals\",\n                 \"\\neven as total guests nights has grown in Fiji\"),\n    subtitle = glue(\"{hotel_year_min} to {hotel_year_max}.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 6.7: Guest rooms",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Overseas arrivals, tourism revenue, and hotel nights</span>"
    ]
  },
  {
    "objectID": "trade.html",
    "href": "trade.html",
    "title": "7  Exports, Imports and Balance of Trade",
    "section": "",
    "text": "7.1 Exports\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"domestic_exports\", \"re_exports\") ) \n\ndta_for_plot_labels &lt;- dta_for_plot |&gt;\n  filter(year == 2023) |&gt;\n  group_by(metric) |&gt;\n  slice_max(order_by = abs(value),\n            n = 5) |&gt;\n  ungroup() |&gt;\n  select(country, metric) |&gt;\n  mutate(country_label = country)\n\np1 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = country, group = country)) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  geom_text_repel(aes(x = 2024, \n                y = if_else(year == 2023,\n                            value,\n                            NA_real_), \n                label = country_label),\n            size = 3, hjust = 0,\n            direction = \"y\",\n            na.rm = TRUE,\n            show.legend = FALSE) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  expand_limits(x = 2030) +\n  facet_wrap(~ metric) +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = country, group = country)) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  geom_text_repel(aes(x = 2024, \n                y = if_else(year == 2023,\n                            value,\n                            NA_real_), \n                label = country_label),\n            size = 3, hjust = 0,\n            direction = \"y\",\n            na.rm = TRUE,\n            show.legend = FALSE) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  expand_limits(x = 2030) +\n  facet_wrap(~ metric) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji exports\",\n    subtitle = glue(\"Top five countries in 2023 labeled for each metric.\", \n                    \" {trade_year_min} to {trade_year_max}, excluding 2020-2022.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.1: Fiji exports\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"domestic_exports\", \"re_exports\") ) |&gt;\n  mutate(country_facet = fct_reorder(country, -value, sum))\n\np1 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = TRUE\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = 1) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  facet_wrap(~ country_facet) +\n  theme(legend.position = \"top\") +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = 1) +\n  facet_wrap(~ country_facet) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji exports faceted by country\",\n    subtitle = glue(\"{trade_year_min} to {trade_year_max}, excluding 2020-2022.\", \n                    \" Facets ordered by total exports over time period.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.2: Fiji exports faceted by country\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"domestic_exports\", \"re_exports\") ) |&gt;\n  mutate(country_facet = fct_reorder(country, -value, sum))\n\np1 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = TRUE\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = 1) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  facet_wrap(~ country_facet, scales = \"free_y\") +\n  theme(legend.position = \"top\") +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = 1) +\n  facet_wrap(~ country_facet, scales = \"free_y\") +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji exports faceted by country (Y axis scale varies)\",\n    subtitle = glue(\"{trade_year_min} to {trade_year_max}, excluding 2020-2022.\",\n                    \" Facets ordered by total exports over time period.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.3: Fiji exports faceted by country (Y axis scale varies to make country-level trends more visible)",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Exports, Imports and Balance of Trade</span>"
    ]
  },
  {
    "objectID": "trade.html#imports",
    "href": "trade.html#imports",
    "title": "7  Exports, Imports and Balance of Trade",
    "section": "7.2 Imports",
    "text": "7.2 Imports\n\n\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"domestic_imports\", \"imports\") ) |&gt;\n  mutate(country_facet = fct_reorder(country, -value, sum))\n\np1 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = TRUE\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = -1) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  facet_wrap(~ country_facet) +\n  theme(legend.position = \"top\") +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = -1) +\n  facet_wrap(~ country_facet) +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji imports faceted by country\",\n    subtitle = glue(\"{trade_year_min} to {trade_year_max}, excluding 2020-2022.\",\n                    \"\\nFacets ordered by total imports over time period.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.4: Fiji imports faceted by country\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"domestic_imports\", \"imports\") ) |&gt;\n  mutate(country_facet = fct_reorder(country, -value, sum))\n\np1 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = TRUE\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = -1) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  expand_limits(y = 0) +\n  facet_wrap(~ country_facet, scales = \"free_y\") +\n  theme(legend.position = \"top\") +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  scale_color_viridis_d(end = 0.9, direction = -1) +\n  expand_limits(y = 0) +\n  facet_wrap(~ country_facet, scales = \"free_y\") +\n  coord_cartesian(ylim = c(0, NA)) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\",\n    color = NULL\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji imports faceted by country (Y axis scale varies)\",\n    subtitle = glue(\"{trade_year_min} to {trade_year_max}, excluding 2020-2022.\",\n                    \" Facets ordered by total imports over time period.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.5: Fiji imports faceted by country (Y axis varies to make country-level trends more visible)",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Exports, Imports and Balance of Trade</span>"
    ]
  },
  {
    "objectID": "trade.html#balance-of-trade",
    "href": "trade.html#balance-of-trade",
    "title": "7  Exports, Imports and Balance of Trade",
    "section": "7.3 Balance of trade",
    "text": "7.3 Balance of trade\n\n\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"trade_deficit_surplus\") ) \n\ndta_for_plot_labels &lt;- dta_for_plot |&gt;\n  filter(year == 2023) |&gt;\n  group_by(metric) |&gt;\n  slice_max(order_by = abs(value),\n            n = 10) |&gt;\n  ungroup() |&gt;\n  select(country, metric) |&gt;\n  mutate(country_label = country)\n\np1 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = country, group = country)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpha = 0.5) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  geom_text_repel(aes(x = 2024, \n                y = if_else(year == 2023,\n                            value,\n                            NA_real_), \n                label = country_label),\n            size = 3, hjust = 0,\n            direction = \"y\",\n            na.rm = TRUE,\n            show.legend = FALSE) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  expand_limits(x = 2030) +\n  facet_wrap(~ metric) +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = country, group = country)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpha = 0.5) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  geom_text_repel(aes(x = 2024, \n                y = if_else(year == 2023,\n                            value,\n                            NA_real_), \n                label = country_label),\n            size = 3, hjust = 0,\n            direction = \"y\",\n            na.rm = TRUE,\n            show.legend = FALSE) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  expand_limits(x = 2030) +\n  facet_wrap(~ metric) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji blance of trade\",\n    subtitle = glue(\"Top ten countries with which Fiji had largest surplus or deficit in 2023 labeled.\", \n                    \" {trade_year_min} to {trade_year_max}, excluding 2020-2022.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.6: Fiji balance of trade\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"trade_deficit_surplus\") ) |&gt;\n  mutate(country_facet = fct_reorder(country, -value, sum))\n\np1 &lt;- dta_for_plot |&gt;\n  # left_join(\n  #   dta_for_plot_labels,\n  #   by = c(\"country\", \"metric\")\n  # ) |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpha = 0.5) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  facet_wrap(~ country_facet) +\n  theme(legend.position = \"top\") +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpha = 0.5) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  facet_wrap(~ country_facet) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji balance of trade faceted by country\",\n    subtitle = glue(\"{trade_year_min} to {trade_year_max}, excluding 2020-2022.\", \n                    \" Facets ordered by sum of balance over time period.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.7: Fiji balance of trade faceted by country\n\n\n\n\n\n\n\n\nShow the code\ndta_for_plot &lt;- dta_for_plot_all |&gt;\n  filter(metric %in% c(\"trade_deficit_surplus\") ) |&gt;\n  mutate(country_facet = fct_reorder(country, -value, sum))\n\np1 &lt;- dta_for_plot |&gt;\n  left_join(\n    dta_for_plot_labels,\n    by = c(\"country\", \"metric\")\n  ) |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpha = 0.5) +\n  geom_line(\n    linewidth = 0.5,\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  facet_wrap(~ country_facet, scales = \"free_y\") +\n  theme(legend.position = \"top\") +\n  labs(\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np2 &lt;- dta_for_plot |&gt;\n  ggplot(aes(year, value, color = metric, group = metric)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpha = 0.5) +\n  geom_smooth(\n    linewidth = 0.5,\n    se = FALSE, method = 'loess', formula = 'y ~ x',\n    na.rm = TRUE,\n    show.legend = FALSE\n  ) +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  scale_y_continuous(expand = expansion(mult = c(0.005, 0.02))) +\n  facet_wrap(~ country_facet, scales = \"free_y\") +\n  # coord_cartesian(ylim = c(0, NA)) +\n  labs(\n    subtitle = \"Smoothed lines\",\n    x = NULL,\n    y = \"FJD ($M)\"\n  )\n\np1 / p2 +\n  plot_annotation(\n    title = \"Fiji balance of trade faceted by country\",\n    subtitle = glue(\"{trade_year_min} to {trade_year_max}, excluding 2020-2022.\",\n                    \" Facets ordered by sum of balance over time period.\"),\n    caption = my_caption_fbos\n  )\n\n\n\n\n\n\n\n\nFigure 7.8: Fiji balance of trade faceted by country (Y axis varies to make country-level trends more visible)",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Exports, Imports and Balance of Trade</span>"
    ]
  },
  {
    "objectID": "trade.html#general-notes",
    "href": "trade.html#general-notes",
    "title": "7  Exports, Imports and Balance of Trade",
    "section": "7.4 General Notes",
    "text": "7.4 General Notes\n\nDifferences from previously published tables are due to revisions.\nOthers includes France, Netherlands, Spain & Other Asian Countries (Indonesia, Korea, Malaysia, Thailand and Vietnam) from 2023 onwards.\nData for the years 2015, 2018, 2019, 2021 & 2023 have been revised.\nData for the year 2023 is provisional.\n\nDaniel’s additional notes\n\ndomestic exports, re-exports, and total exports are F.O.B.\nimports are C.I.F.\ndomestic imports are imports less re-exports\nall amounts are nominal dollars FJD (not adjusted for inflation)",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Exports, Imports and Balance of Trade</span>"
    ]
  },
  {
    "objectID": "cpi.html",
    "href": "cpi.html",
    "title": "8  Consumer prices",
    "section": "",
    "text": "8.1 Consumer price index\nThe Reserve Bank of Fiji makes available historical consumer price data going back to 1991, rebased in 2005, 2008, 2011, and 2014. The CPI is based on the relative prices of a set of component categories weighted to reflect consumer spending. Each component’s relative price is determined by a basket of products, the details of which are not available. The component categories changed between 2005 and 2008 (making comparisons between them difficult). Fortunately, only the weightings changed in subsequent rebases. Where year-to-year price changes were included in multiple rebases, I averaged them to calculate a single, simple, non-authoritative CPI for the entire period.\nShow the code\ncpi_2005_base_raw &lt;- read_xlsx(here(\"data/raw/rbf/7.1-Consumer-Price-Index-fixed.xlsx\"),\n                   range = \"A3:U28\") |&gt;\n  clean_names() |&gt;\n  remove_empty(which = c(\"rows\", \"cols\"))\n\ncpi_2008_base_raw &lt;- read_xlsx(here(\"data/raw/rbf/7.1-Consumer-Price-Index-fixed.xlsx\"),\n                   range = \"A33:U40\") |&gt;\n  clean_names() |&gt;\n  remove_empty(which = c(\"rows\", \"cols\"))\n\ncpi_2011_base_raw &lt;- read_xlsx(here(\"data/raw/rbf/7.1-Consumer-Price-Index-fixed.xlsx\"),\n                   range = \"A45:U55\") |&gt;\n  clean_names() |&gt;\n  remove_empty(which = c(\"rows\", \"cols\"))\n\ncpi_2014_base_raw &lt;- read_xlsx(here(\"data/raw/rbf/7.1-Consumer-Price-Index-fixed.xlsx\"),\n                   range = \"A60:U70\") |&gt;\n  clean_names() |&gt;\n  remove_empty(which = c(\"rows\", \"cols\"))\n\ncpi_merged &lt;- bind_rows(\n  cpi_2005_base_raw |&gt;\n    mutate(base = 2005),\n  cpi_2008_base_raw |&gt;\n    mutate(base = 2008),\n  cpi_2011_base_raw |&gt;\n    mutate(base = 2011),\n  cpi_2014_base_raw |&gt;\n    mutate(base = 2014)\n)\n\ncpi_weights &lt;-  bind_rows(\n  # cpi_2005_base_raw |&gt;\n  #   mutate(base = 2005),\n  cpi_2008_base_raw |&gt;\n    mutate(base = 2008),\n  cpi_2011_base_raw |&gt;\n    mutate(base = 2011),\n  cpi_2014_base_raw |&gt;\n    mutate(base = 2014)\n) |&gt;\n  filter(period == \"Weight\") |&gt;\n  remove_empty(which = \"cols\") |&gt;\n  select(-period)\n\ncpi &lt;- cpi_merged |&gt;\n  select(period, year_on_year_percent_change, base) |&gt;\n  filter(period != \"Weight\") |&gt;\n  mutate(year = as.numeric(period)) |&gt;\n  summarize(yty = mean(year_on_year_percent_change) / 100,\n            cpi = 0,\n         .by = year) #|&gt;\n  # mutate(cpi = lag(cpi) * (1 + yty)) #lag(yty, default = 0)))\n\n# since lag() doesn't seem to get the whole vector at the beginning of the call, I cannot \n# modify cpi while lagging it. So instead I use the following:\nfor(i in 1:length(cpi$yty)) {\n   if(i == 1) {\n    cpi$cpi[i] &lt;- 1\n  } else {\n    cpi$cpi[i] &lt;- cpi$cpi[i - 1] * (1 + cpi$yty[i])\n  }\n}\n\ncpi_year_min &lt;- min(cpi$year)\ncpi_year_max &lt;- max(cpi$year)\n\ndta_for_cpi_weight_plot &lt;- cpi_merged |&gt;\n  filter(base != 2005,\n         period != \"Weight\") |&gt;\n  distinct(base, period) |&gt;\n  left_join(\n    cpi_weights,\n    by = \"base\"\n  ) |&gt;\n  select(-all_items) |&gt;\n  rename(communicaitons = communi_cations) |&gt;\n  mutate(base = as.character(base),\n         period = as.numeric(period)) |&gt;\n  pivot_longer(\n    cols = food_and_non_alcoholic_beverage:recreation_culture,\n    names_to = \"metric\",\n    values_to = \"value\"\n  )\n\nus_cpi &lt;- read_xlsx(here(\"data/raw/rbf/us-cpi-historical.xlsx\"),\n                   skip = 7) |&gt;\n  clean_names() |&gt;\n  mutate(cpi_base_1991 = cpi / cpi[year == 1991])\nShow the code\np1 &lt;- cpi |&gt;\n  ggplot(aes(year, yty)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpa = 0.5) +\n  geom_line() +\n  geom_line(data = us_cpi |&gt;\n              filter(year &gt;= 1991),\n            aes(year, annual_pct_change),\n            color = \"firebrick\", linewidth = 0.2,\n            alpha = 0.75) +\n  annotate(\"text\", x = 2002, y = -0.01, label = \"US yty pct change\",\n           hjust = 0, color = \"firebrick\", alpha = 0.75) +\n  scale_y_continuous(labels = label_percent()) +\n  labs(\n    subtitle = glue(\"Year to year change in consumer prices\",\n                    \"\\nIn Fiji and US\")\n  )\n\np2 &lt;- cpi |&gt;\n  ggplot() +\n  geom_line(aes(year, cpi)) +\n  geom_line(data = us_cpi |&gt;\n              filter(year &gt;= 1991),\n            aes(year, cpi_base_1991),\n            color = \"firebrick\", linewidth = 0.2,\n            alpha = 0.75) +\n  annotate(\"text\", x = 2011, y = 1.5, label = \"US CPI\",\n           hjust = 0, color = \"firebrick\", alpha = 0.75) +\n  labs(\n    subtitle = glue(\"Fiji prices doubled in ~20 years\",\n                    \"\\nwhile US prices doubled in ~30 years\",\n                    \"\\nCPI: {cpi_year_min} = 100\"),\n    y = \"Consumer price index\"\n  )\n\np1 + p2 +\n  plot_annotation(\n    title = \"Consumer price changes in Fiji\",\n    subtitle = glue(\"{cpi_year_min} to {cpi_year_max}. With US comparisons.\"),\n    caption = paste0(my_caption_rbf,\n                     \" and Minneapolis Federal Reserve Bank\")\n  )\n\n\n\n\n\n\n\n\nFigure 8.1: Fiji consumer price index\nShow the code\ndta_for_cpi_weight_plot |&gt;\n  ggplot(aes(period, value, color = base)) +\n  geom_hline(yintercept = 0, lty = 2, linewidth = 0.15, alpa = 0.5) +\n  geom_line() +\n  guides(color = guide_legend(override.aes = list(linewidth = 3))) +\n  facet_wrap(~metric) +\n  theme(legend.position = \"top\") +\n  labs(\n    title = glue(\"Changes have been modest in the relative weightings\",\n                 \"\\nof Fiji CPI components\"),\n    x = NULL,\n    y = \"Relative weighting\",\n    caption = my_caption_rbf\n  )\n\n\n\n\n\n\n\n\nFigure 8.2: Fiji consumer price index weightings\nShow the code\ndta_for_plot &lt;- cpi_merged |&gt;\n  filter(base != 2005,\n         period != \"Weight\") |&gt;\n  remove_empty(which = \"cols\") |&gt;\n  rename(communicaitons = communi_cations) |&gt;\n  select(-year_on_year_percent_change, -all_items) |&gt;\n  relocate(base, .before = period) |&gt;\n  mutate(period = as.numeric(period),\n         base = glue(\"base: {base}\")) |&gt;\n  pivot_longer(\n    cols = clothing_footwear:recreation_culture,\n    names_to = \"metric\",\n    values_to = \"value\"\n  )\n  \ndta_for_plot |&gt;\n  ggplot(aes(period, value, color = metric, group = metric)) +\n  geom_hline(yintercept = 100, lty = 2, linewidth = 0.15, alpa = 0.5) +\n  geom_line() +\n  scale_x_continuous(breaks = c(2010, 2015, 2020, 2023)) +\n  facet_wrap(~base) +\n  guides(color = guide_legend(ncol = 3,\n                              override.aes = list(linewidth = 3))\n         ) +\n  theme(legend.position = \"bottom\") +\n  labs(\n    title = \"The largest price changes were in alcohol, tobacco and narcotics\",\n    subtitle = glue(\"Changes in prices of the components of Fiji CPI\",\n                    \"\\nYear of base == 100\"),\n    x = NULL,\n    y = NULL,\n    color = NULL,\n    caption = my_caption_rbf\n  )\n\ndta_for_plot |&gt;\n  ggplot(aes(period, value, color = base, group = base)) +\n  geom_hline(yintercept = 100, lty = 2, linewidth = 0.15, alpa = 0.5) +\n  geom_line() +\n  scale_x_continuous(breaks = c(2010, 2015, 2020, 2023)) +\n  facet_wrap(~metric) +\n  guides(color = guide_legend(ncol = 3,\n                              override.aes = list(linewidth = 3))\n         ) +\n  theme(legend.position = \"bottom\") +\n  labs(\n    title = \"Changes in prices of the components of Fiji CPI\",\n    subtitle = \"Year of base == 100\",\n    x = NULL,\n    y = NULL,\n    color = NULL,\n    caption = my_caption_rbf\n  )\n\ndta_for_plot |&gt;\n  ggplot(aes(period, value, color = base, group = base)) +\n  geom_hline(yintercept = 100, lty = 2, linewidth = 0.15, alpa = 0.5) +\n  geom_line() +\n  scale_x_continuous(breaks = c(2010, 2015, 2020, 2023)) +\n  facet_wrap(~metric, scales = \"free_y\") +\n  guides(color = guide_legend(ncol = 3,\n                              override.aes = list(linewidth = 3))\n         ) +\n  theme(legend.position = \"bottom\") +\n  labs(\n    title = glue(\"The most signficant changes (especially for the poor)\", \n                 \"\\nwere in the price of food and non-alcoholic beverages\"),\n    subtitle = glue(\"Changes in prices of the components of Fiji CPI\",\n                    \"\\nYear of base == 100\"),\n    x = NULL,\n    y = NULL,\n    color = NULL,\n    caption = my_caption_rbf\n  )\n\n\n\n\n\n\n\n\nFigure 8.3: Fiji consumer price index component price changes\n\n\n\n\n\n\n\n\n\n\n\nFigure 8.4: Fiji consumer price index component price changes\n\n\n\n\n\n\n\n\n\n\n\nFigure 8.5: Fiji consumer price index component price changes\nShow the code\ndta_for_plot &lt;- cpi_merged |&gt;\n  filter(base != 2005,\n         period != \"Weight\") |&gt;\n  remove_empty(which = \"cols\") |&gt;\n  rename(communicaitons = communi_cations) |&gt;\n  select(-year_on_year_percent_change, -all_items) |&gt;\n  relocate(base, .before = period) |&gt;\n  mutate(period = as.numeric(period),\n         base = glue(\"base: {base}\")) |&gt;\n  pivot_longer(\n    cols = clothing_footwear:recreation_culture,\n    names_to = \"metric\",\n    values_to = \"value\"\n  ) |&gt;\n  left_join(\n    dta_for_cpi_weight_plot |&gt;\n      mutate(base = glue(\"base: {base}\")) |&gt;\n      rename(weight = value),\n    by = c(\"base\", \"period\", \"metric\")\n  ) |&gt;\n  mutate(weighted_value = weight * value,\n         metric = fct_reorder(metric, -weighted_value, min))\n\ndta_for_plot |&gt;\n  ggplot(aes(period, weighted_value, color = base, group = base)) +\n  geom_hline(yintercept = 100, lty = 2, linewidth = 0.15, alpa = 0.5) +\n  geom_line() +\n  scale_x_continuous(breaks = c(2010, 2015, 2020, 2023)) +\n  facet_wrap(~metric) + #, scales = \"free_y\") +\n  guides(color = guide_legend(ncol = 3,\n                              override.aes = list(linewidth = 3))\n         ) +\n  theme(legend.position = \"bottom\") +\n  labs(\n    title = glue(\"The most signficant changes for consumers were in the price of\", \n                 \"\\nfood and non-alcoholic beverages\"),\n    subtitle = glue(\"Changes in prices of the components of Fiji CPI.\",\n                    \"\\nWeighted_value is weight * relative price.\"),\n    x = NULL,\n    y = \"Weighted value\",\n    color = NULL,\n    caption = my_caption_rbf\n  )\n\ndta_for_plot |&gt;\n  ggplot(aes(period, weighted_value, color = base, group = base)) +\n  geom_hline(yintercept = 100, lty = 2, linewidth = 0.15, alpa = 0.5) +\n  geom_line() +\n  scale_x_continuous(breaks = c(2010, 2015, 2020, 2023)) +\n  facet_wrap(~metric, scales = \"free_y\") +\n  guides(color = guide_legend(ncol = 3,\n                              override.aes = list(linewidth = 3))\n         ) +\n  theme(legend.position = \"bottom\") +\n  labs(\n    title = glue(\"The most signficant changes for consumers were in the price of\", \n                 \"\\nfood and non-alcoholic beverages\"),\n    subtitle = glue(\"Changes in prices of the components of Fiji CPI.\",\n                    \"\\nWeighted_value is weight * relative price. Y axis scale varies.\"),\n    x = NULL,\n    y = \"Weighted value\",\n    color = NULL,\n    caption = my_caption_rbf\n  )\n\n\n\n\n\n\n\n\nFigure 8.6: Fiji consumer price index component changes with weightings\n\n\n\n\n\n\n\n\n\n\n\nFigure 8.7: Fiji consumer price index component changes with weightings",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Consumer prices</span>"
    ]
  },
  {
    "objectID": "cpi.html#general-notes",
    "href": "cpi.html#general-notes",
    "title": "8  Consumer prices",
    "section": "8.2 General Notes:",
    "text": "8.2 General Notes:\nDisclaimer: Please refer to the Reserve Bank of Fiji Disclaimer available on our website: https://www.rbf.gov.fj/disclaimer/",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Consumer prices</span>"
    ]
  },
  {
    "objectID": "notes.html",
    "href": "notes.html",
    "title": "9  Notes and sources",
    "section": "",
    "text": "9.1 Pocket summary statistics\nData source: https://pacificdata.org/data/dataset/overseas-visitor-arrivals-df-overseas-visitors downloaded 2024-06-12.",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#visitor-arrivals",
    "href": "notes.html#visitor-arrivals",
    "title": "9  Notes and sources",
    "section": "9.2 Visitor arrivals",
    "text": "9.2 Visitor arrivals\nData source: https://pacificdata.org/data/dataset/overseas-visitor-arrivals-df-overseas-visitors downloaded 2024-06-16.",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#map-basics",
    "href": "notes.html#map-basics",
    "title": "9  Notes and sources",
    "section": "9.3 Map basics",
    "text": "9.3 Map basics\n\n9.3.1 OSM and OSM\nOpenStreetMap data is (C) OpenStreetMap Contributors.\nOpenSeaMap (description) uses data from OpenStreetMap and other sources.\n\n\n9.3.2 GEBCO gridded bathymetic\nThe General Bathymetric Chart of the Oceans (GEBCO) https://www.gebco.net/about_us/overview/\nGEBCO_22_Jun_2024_4b31746b7734.zip downloaded 2024-06-22 from https://download.gebco.net",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#global-distribution-of-coral-reefs",
    "href": "notes.html#global-distribution-of-coral-reefs",
    "title": "9  Notes and sources",
    "section": "9.4 Global distribution of coral reefs",
    "text": "9.4 Global distribution of coral reefs\nhttps://pacificdata.org/data/dataset/global-distribution-of-coral-reefs pointed me to https://data.unep-wcmc.org/datasets/1 where I downloaded the data on 2024-06-24.\nLAST PAGE UPDATE: 15/02/23\nThis dataset shows the global distribution of coral reefs in tropical and subtropical regions. It is the most comprehensive global dataset of warm-water coral reefs to date, acting as a foundation baseline map for future, more detailed, work. This dataset was compiled from a number of sources by UNEP World Conservation Monitoring Centre (UNEP-WCMC) and the WorldFish Centre, in collaboration with WRI (World Resources Institute) and TNC (The Nature Conservancy). Data sources include the Millennium Coral Reef Mapping Project (IMaRS-USF and IRD 2005, IMaRS-USF 2005) and the World Atlas of Coral Reefs (Spalding et al. 2001).\nUNEP-WCMC, WorldFish Centre, WRI, TNC (2021). Global distribution of warm-water coral reefs, compiled from multiple sources including the Millennium Coral Reef Mapping Project. Version 4.1. Includes contributions from IMaRS-USF and IRD (2005), IMaRS-USF (2005) and Spalding et al. (2001). Cambridge (UK): UN Environment World Conservation Monitoring Centre. Data DOI: https://doi.org/10.34892/t2wk-5t34\n\n9.4.1 Citations for the separate entities\nIMaRS-USF (Institute for Marine Remote Sensing-University of South Florida) (2005). Millennium Coral Reef Mapping Project. Unvalidated maps. These maps are unendorsed by IRD, but were further interpreted by UNEP World Conservation Monitoring Centre. Cambridge (UK): UNEP World Conservation Monitoring Centre\nIMaRS-USF, IRD (Institut de Recherche pour le Developpement) (2005). Millennium Coral Reef Mapping Project. Validated maps. Cambridge (UK): UNEP World Conservation Monitoring Centre\nSpalding MD, Ravilious C, Green EP (2001). World Atlas of Coral Reefs. Berkeley (California, USA): The University of California Press. 436 pp.\n\n\n9.4.2 USE CONSTRAINTS\nUNEP-WCMC General Data License.\nFor commercial use, please contact business-support@unep-wcmc.org.\n\nMetadata link points to file WCMC_008_Global_Distribution_of_Coral_Reefs.pdf\nFactsheet link points to https://biodiversitya-z.org/content/warm-water-coral-reef also warm-water-coral-reef-factsheet.pdf",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#risk-of-coral-bleaching-noaa-coral-reef-watch",
    "href": "notes.html#risk-of-coral-bleaching-noaa-coral-reef-watch",
    "title": "9  Notes and sources",
    "section": "9.5 Risk of coral bleaching: NOAA Coral Reef Watch",
    "text": "9.5 Risk of coral bleaching: NOAA Coral Reef Watch\nData source https://coralreefwatch.noaa.gov/product/vs/data/fiji.txt downloaded 2024-06-09.\nPlots of a number of island nations: https://coralreefwatch.noaa.gov/product/vs/timeseries/melanesia.php#fiji\nDescription for Daily 5km Regional Virtual Stations, Time Series Data, and Graphs (Updated June 8, 2020) https://coralreefwatch.noaa.gov/product/vs/description.php#ascii",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#statsfiji",
    "href": "notes.html#statsfiji",
    "title": "9  Notes and sources",
    "section": "9.6 StatsFiji",
    "text": "9.6 StatsFiji\nhttps://www.statsfiji.gov.fj\nhttps://www.statsfiji.gov.fj/images/documents/Fiji_MICS_2021/Fiji_MICS_2021_Fact_Sheet_-_Preliminary_Report.pdf",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#fiji-ocean-policy-2020-2030",
    "href": "notes.html#fiji-ocean-policy-2020-2030",
    "title": "9  Notes and sources",
    "section": "9.7 Fiji Ocean Policy 2020-2030",
    "text": "9.7 Fiji Ocean Policy 2020-2030\nCitation: Fiji Ministry of Economy. (2021). Republic of Fiji National Ocean Policy 2020-2030. Suva, Fiji: Ministry of Economy. 70 p.\nAvailable from https://fijiclimatechangeportal.gov.fj/ppss/republic-of-fiji-national-ocean-policy-2020-2030/\nSpecifically: http://fijiclimatechangeportal.gov.fj/wp-content/uploads/2021/01/Fiji_NationalOceansPolicy_2020.pdf",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#reserve-bank-of-fiji",
    "href": "notes.html#reserve-bank-of-fiji",
    "title": "9  Notes and sources",
    "section": "9.8 Reserve Bank of Fiji",
    "text": "9.8 Reserve Bank of Fiji\nTODO: Add here",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#world-health-organization",
    "href": "notes.html#world-health-organization",
    "title": "9  Notes and sources",
    "section": "9.9 World Health Organization",
    "text": "9.9 World Health Organization\nTODO: Add here",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  },
  {
    "objectID": "notes.html#not-used",
    "href": "notes.html#not-used",
    "title": "9  Notes and sources",
    "section": "9.10 Not used",
    "text": "9.10 Not used\nI looked at the following but for various reasons decided not to include them. I offer links here in case someone wishes to explore them.\n\n9.10.1 PopGIS3 Fiji\nhttp://fiji.popgis.spc.int/#bbox=21562,8526695,1053531,882426&c=indicator&i=d2_pop2017.t_pop&t=A07&view=map6\n2017 Census by Division\n\n\n9.10.2 All SDG data for Fiji\nhttps://pacificdata.org/data/dataset/sdg-country-package-for-fiji-dv-sdg-fj\nDataset description: “This is a subset of Sustainable Development Goals (all) Contains available data on Pacific Sustainable Development Indicators selected by the region and endorsed by Forum Leaders in the…”. Source: SDG country package for Fiji\n\n\n9.10.3 populuation.un.org\nhttps://population.un.org/wpp/\nThe data portal https://population.un.org/dataportal/ looks interesting, however it was too slow and/or didn’t return data in some cases.\nReferenced from https://database.earth/population/fiji",
    "crumbs": [
      "Human dynamics",
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Notes and sources</span>"
    ]
  }
]