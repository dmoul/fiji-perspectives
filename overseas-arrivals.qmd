# Overseas visitors

Among the PICTs, tourism is a significant source of foreign currency and local employment. The COVID-19 pandemic shut down most overseas travel, and as of 2022 annual numbers did not returned to pre-pandemic trends. Overseas visitors include sea and air arrivals. It includes excursionists/same-day-visitors i.e. visitors from cruise ships.

Fiji is second, behind only Guam in number of overseas arrivals. Are U.S. active military personnel included in Guam's numbers? If so then Fiji would be first in yearly non-military visitors: mainly people traveling for holiday, work, or visiting friends and family.

```{r}
#| label: setup
#| message: false
#| warning: false

library(here)
library(tidyverse)
library(janitor)
library(scales)
library(glue)
library(sf)
library(terra)
library(tidyterra) # for scale_*_hypso_tint_c()
library(patchwork)

theme_set(theme_light() +
            theme(panel.grid.major = element_blank(),
                  panel.grid.minor = element_blank()))

options(scipen = 5)

my_caption <- "Plot: Daniel Moul; Data: South Pacific Community"

```

```{r}
#| label: prepare-overseas-visitors-data

visitors_all_cat <- read_csv(here("./data/raw/overseas-visitor-arrivals/SPC-DF_OVERSEAS_VISITORS-2.0-all.csv"),
               show_col_types = FALSE) |>
  clean_names() |>
  remove_empty(which = "cols")

visitors_total <- visitors_all_cat |>
  filter(overseas_visitors_type_2 == "Total") |>
  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |>
  mutate(max_annual = max(obs_value),
         pct_of_max = obs_value / max_annual,
         min_year = min(time_period),
         max_year = max(time_period),
         pct_of_first_year = obs_value / obs_value[time_period == min_year],
         .by = pacific_island_countries_and_territories)

```

Most PICTs experienced a positive trend in annual visitors until the COVID-19 pandemic.

```{r}
#| label: fig-overseas-visitors
#| fig-cap: "Annual overseas visitors"
#| fig-width: 10
#| fig-height: 10

visitors_total |>
  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |>
  ggplot() +
  geom_line(aes(time_period, obs_value, 
                color = if_else(place == "Fiji",
                                     "purple", 
                                     "black"))) +
  
  scale_color_identity() +
  facet_wrap(~place, scales = "free_y") +
  labs(
    title = "Annual overseas visitors",
    subtitle = "2005-2022; Y axis varies",
    x = NULL,
    y = NULL,
    caption = my_caption
  )
```

<br>

There are many ways one could compare the overseas visitors numbers among PICTs. I offer four below.

```{r}
#| label: fig-overseas-visitors-scaled-2
#| fig-cap:  "Annual overseas visitor trends: four views"
#| fig-width: 12
#| fig-height: 10

p0 <- visitors_total |>
  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |>
  ggplot() +
  geom_line(aes(time_period, obs_value + 1, 
                color = if_else(place == "Fiji",
                                     "purple", 
                                     "black"),
                linewidth = if_else(place == "Fiji",
                                     1, 
                                     0),
                group = place),
            alpha = 0.5
            ) +
  geom_smooth(aes(time_period, obs_value + 1),
              method = "loess", formula = 'y ~ x',
              span = 0.2, se = FALSE) +
  scale_color_identity() +
  scale_linewidth_continuous(range = c(0.25, 1.0)) +
  scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),
                     labels = label_number(big.mark = ",")) +
  guides(linewidth = "none") +
  labs(
    subtitle = "A: Count",
    x = NULL,
    y = NULL
  )

p1 <- visitors_total |>
  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |>
  ggplot() +
  geom_line(aes(time_period, obs_value + 1, 
                color = if_else(place == "Fiji",
                                     "purple", 
                                     "black"),
                linewidth = if_else(place == "Fiji",
                                     1, 
                                     0),
                group = place),
            alpha = 0.5
            ) +
  geom_smooth(aes(time_period, obs_value + 1),
              method = "loess", formula = 'y ~ x',
              span = 0.2, se = FALSE) +
  scale_color_identity() +
  scale_linewidth_continuous(range = c(0.25, 1.0)) +
  scale_y_log10(expand = expansion(mult = c(0.01, 0.05)),
                labels = label_number(big.mark = ",")) +
  guides(linewidth = "none") +
  labs(
    subtitle = "B: Count (log10 scale)",
    x = NULL,
    y = NULL
  )

p2 <- visitors_total |>
  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |>
  ggplot() +
  geom_line(aes(time_period, pct_of_first_year, 
                color = if_else(place == "Fiji",
                                     "purple", 
                                     "black"),
                linewidth = if_else(place == "Fiji",
                                     1, 
                                     0),
                group = place),
            alpha = 0.5
            ) +
  geom_smooth(aes(time_period, pct_of_first_year),
              method = "loess", formula = 'y ~ x',
              span = 0.2, se = FALSE) +
  scale_color_identity() +
  scale_linewidth_continuous(range = c(0.25, 1.0)) +
  scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),
                     labels = label_number(big.mark = ",")) +
  guides(linewidth = "none") +
  labs(
    subtitle = "C: Trends normalized (1.0 = value for each place at first year in data set)",
    x = NULL,
    y = NULL
  )

p3 <- visitors_total |>
  mutate(place = fct_reorder(pacific_island_countries_and_territories, -obs_value, sum)) |>
  ggplot() +
  geom_line(aes(time_period, pct_of_max, 
                color = if_else(place == "Fiji",
                                     "purple", 
                                     "black"),
                linewidth = if_else(place == "Fiji",
                                     1, 
                                     0),
                group = place),
            alpha = 0.5
            ) +
  geom_smooth(aes(time_period, pct_of_max),
              method = "loess", formula = 'y ~ x',
              span = 0.2, se = FALSE) +
  scale_color_identity() +
  scale_linewidth_continuous(range = c(0.25, 1.0)) +
  scale_y_continuous(expand = expansion(mult = c(0.01, 0.05)),
                     labels = label_number(big.mark = ",")) +
  guides(linewidth = "none") +
  labs(
    subtitle = "D: Trends normalized (1.0 = max for each place)",
    x = NULL,
    y = NULL
  )

p0 + p1 + p2 + p3 +
  plot_annotation(
    title = "Annual overseas visitor trends: four views",
    subtitle = "Fiji = purple. 2000-2022",
    caption = my_caption
  )

```

<br>
